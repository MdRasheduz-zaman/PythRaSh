<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="dcterms.date" content="2025-09-26">
<title>pythrash - Panda Dataframe, scypy, numpy, data typing, etc.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="../../_include/styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">PythRaSh</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r">
<li>
    <a class="dropdown-item" href="../../ch/rbasics/git.html" rel="" target="">
 <span class="dropdown-text">git</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/rbasics/firststeps.html" rel="" target="">
 <span class="dropdown-text">Basic R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/rbasics/tidyverse.html" rel="" target="">
 <span class="dropdown-text">The tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/rbasics/correlation_regression.html" rel="" target="">
 <span class="dropdown-text">Advanced R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/rbasics/baddata.html" rel="" target="">
 <span class="dropdown-text">Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/rbasics/solutions.html" rel="" target="">
 <span class="dropdown-text">Problem Solutions</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-python" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Python</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-python">
<li>
    <a class="dropdown-item" href="../../ch/python/basics.html" rel="" target="">
 <span class="dropdown-text">Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/python/uv_tutorial.html" rel="" target="">
 <span class="dropdown-text">UV Package Manager</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/python/panda.html" rel="" target="">
 <span class="dropdown-text">Advanced Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/python/MLA.html" rel="" target="">
 <span class="dropdown-text">Machine Learning Algorithms</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/python/AI.html" rel="" target="">
 <span class="dropdown-text">AI</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-linux-and-clt" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Linux and CLT</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-linux-and-clt">
<li>
    <a class="dropdown-item" href="../../ch/linux-and-ctl/basics.html" rel="" target="">
 <span class="dropdown-text">Linux Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/linux-and-ctl/advanced.html" rel="" target="">
 <span class="dropdown-text">Advanced Command Line</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-probability-and-statistics" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Probability and Statistics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-probability-and-statistics">
<li>
    <a class="dropdown-item" href="../../ch/prob_stat/prob_basic.html" rel="" target="">
 <span class="dropdown-text">Probability Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/prob_stat/stat.html" rel="" target="">
 <span class="dropdown-text">Statistics</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-genomics" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Genomics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-genomics">
<li>
    <a class="dropdown-item" href="../../ch/genomics/basics.html" rel="" target="">
 <span class="dropdown-text">Genomics Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/genomics/advanced.html" rel="" target="">
 <span class="dropdown-text">Advanced Genomics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/genomics/pipeline.html" rel="" target="">
 <span class="dropdown-text">Pipelines</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-newsletter" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Newsletter</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-newsletter">
<li>
    <a class="dropdown-item" href="../../ch/newsletter/index.html" rel="" target="">
 <span class="dropdown-text">All issues</span></a>
  </li>  
    </ul>
</li>
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blogs" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Blogs</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-blogs">
<li>
    <a class="dropdown-item" href="../../ch/blogs/en/index.html" rel="" target="">
 <span class="dropdown-text">English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../ch/blogs/bn/index.html" rel="" target="">
 <span class="dropdown-text">Bangla</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/MdRasheduz-zaman" rel="" target="">
 <span class="menu-text">Contact</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MdRasheduz-zaman/PythRaSh" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#dynamic-data-type" id="toc-dynamic-data-type" class="nav-link active" data-scroll-target="#dynamic-data-type">Dynamic data type</a>
  <ul class="collapse">
<li><a href="#making-fields-optional-and-adding-validation" id="toc-making-fields-optional-and-adding-validation" class="nav-link" data-scroll-target="#making-fields-optional-and-adding-validation">Making Fields Optional and Adding Validation</a></li>
  <li><a href="#advanced-validation-with-custom-validators" id="toc-advanced-validation-with-custom-validators" class="nav-link" data-scroll-target="#advanced-validation-with-custom-validators">Advanced Validation with Custom Validators</a></li>
  <li><a href="#real-world-data-processing-with-pydantic" id="toc-real-world-data-processing-with-pydantic" class="nav-link" data-scroll-target="#real-world-data-processing-with-pydantic">Real-World Data Processing with Pydantic</a></li>
  <li><a href="#saving-and-loading-with-json-schema" id="toc-saving-and-loading-with-json-schema" class="nav-link" data-scroll-target="#saving-and-loading-with-json-schema">Saving and Loading with JSON Schema</a></li>
  <li>
<a href="#summary-the-power-of-pydantic" id="toc-summary-the-power-of-pydantic" class="nav-link" data-scroll-target="#summary-the-power-of-pydantic">Summary: The Power of Pydantic</a>
  <ul class="collapse">
<li><a href="#key-benefits-weve-demonstrated" id="toc-key-benefits-weve-demonstrated" class="nav-link" data-scroll-target="#key-benefits-weve-demonstrated">🎯 <strong>Key Benefits We’ve Demonstrated:</strong></a></li>
  <li><a href="#from-simple-to-sophisticated" id="toc-from-simple-to-sophisticated" class="nav-link" data-scroll-target="#from-simple-to-sophisticated">🚀 <strong>From Simple to Sophisticated:</strong></a></li>
  <li><a href="#when-to-use-pydantic" id="toc-when-to-use-pydantic" class="nav-link" data-scroll-target="#when-to-use-pydantic">💡 <strong>When to Use Pydantic:</strong></a></li>
  </ul>
</li>
  </ul>
</li>
  </ul><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="panda.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Panda Dataframe, scypy, numpy, data typing, etc.</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Md Rasheduzzaman </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.fli.de/de/institute/institut-fuer-infektionsmedizin-imed/">
            FLI Insel Riems
            </a>
          </p>
        <p class="affiliation">
            <a href="https://github.com/MdRasheduz-zaman">
            &amp; Freelancer
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Last updated</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 26, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Content summary</div>
    Pydantic
  </div>
</div>

</header><section id="dynamic-data-type" class="level1"><h1>Dynamic data type</h1>
<p>Data typing in python: It is dynamic in python. But we can put some hints to help users with their input. But still, it can be problematic. See below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(name)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(age)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"thirty"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Rashed
thirty
inserted into the DB</code></pre>
</div>
</div>
<p>You see, nobody is stopping the user to put age as a string. A better way would be to keep a check on the data type using loop. If the data type doesn’t match, we will raise an error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Rashed
30
inserted into the DB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"thirty"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>TypeError: Incorrect data type</code></pre>
</div>
</div>
<p>We see a data type error here, so our system works to catch it.</p>
<p>But this way is not scalable. Let’s work around it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Updated"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Rashed
30
inserted into the DB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>update_patient_data(<span class="st">"Rashed"</span>, <span class="dv">29</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Rashed
29
Updated</code></pre>
</div>
</div>
<p>You see the issue with scalability? How many times will we do it if we have more functions using these variables? Data validation is also very important for us for better control. In the above example, we could put <code>-10</code> as age, it would pass the data type check, there is no stopping. But is it meaningful? So, we could say <code>age</code> can not be less than 0. How to do it?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> age <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Age cannot be less than 0"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(name)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(age)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Inserted into the DB"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Rashed
10
Inserted into the DB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="op">-</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>ValueError: Age cannot be less than 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>TypeError: Incorrect data type</code></pre>
</div>
</div>
<p>Here comes <code>Pydantic</code> to help us checking for</p>
<ul>
<li>Data type, and</li>
<li>Data validation</li>
</ul>
<p>And it does so in 3 steps:</p>
<ul>
<li><ol type="1">
<li>
<strong>Define a Pydantic model (class)</strong> representing the <strong>ideal schema</strong>. This includes the expected fields, their data types and any validation constraint (e.g.&nbsp;<code>lt=0</code> for negative numbers)<br>
</li>
</ol></li>
<li>
<ol start="2" type="1">
<li>
<strong>Instantiate the model with raw input data</strong> or make a Pydantic object (usually a dictionary or JSON-like structure)</li>
</ol>
<ul>
<li>Pydantic will automatically <strong>validate</strong> the data and <strong>coerce</strong> it into the correct Python types (if possible)<br>
</li>
<li>If the data doesn’t meet the model’s criteria, Pydantic raise a <code>ValidationError</code>.<br>
</li>
</ul>
</li>
<li>
<ol start="3" type="1">
<li>Pass the validated model object to functions or use it throughout your codebase.</li>
</ol>
<ul>
<li>This ensures that every part of your program works with <strong>clean, type-safe, and logically valid data</strong>.</li>
</ul>
</li>
</ul>
<p>Let’s use it now. But let’s make the example more realistic. We will make a dataframe with the required fields using pandas first. Then we will insert a patient info into that dataframe if the patient is new. If not, we will update information for that patient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define the model</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory database</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame to store patient records</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> pd.DataFrame({</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'int'</span>),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'weight'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'float'</span>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if patient already exists by name</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> db[<span class="st">'name'</span>].eq(patient.name).<span class="bu">any</span>():</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient '</span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append new patient</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> pd.concat([db, pd.DataFrame([patient.model_dump()])], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find index of the patient by name</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> db.index[db[<span class="st">'name'</span>] <span class="op">==</span> patient.name].tolist()</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> idx:</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient '</span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the record</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    db.loc[idx[<span class="dv">0</span>], [<span class="st">'age'</span>, <span class="st">'weight'</span>]] <span class="op">=</span> patient.age, patient.weight</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Test the system</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial insert</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>patient_info <span class="op">=</span> {<span class="st">'name'</span>: <span class="st">'Rashed'</span>, <span class="st">'age'</span>: <span class="dv">29</span>, <span class="st">'weight'</span>: <span class="st">'55'</span>}</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(<span class="op">**</span>patient_info) <span class="co">#unpacking using 2 star signs</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Inserted patient: Rashed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to insert again (should warn)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>insert_patient_data(patient1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Patient 'Rashed' already exists. Use update instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update patient</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>updated_info <span class="op">=</span> {<span class="st">'name'</span>: <span class="st">'Rashed'</span>, <span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'weight'</span>: <span class="fl">57.5</span>}</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(<span class="op">**</span>updated_info)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Updated patient: Rashed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show database</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
Current Database:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>     name  age  weight
0  Rashed   30    57.5</code></pre>
</div>
</div>
<p>Did you notice something? We put <code>'weight': '55'</code> and PyDantic coerced it to float smartly.</p>
<p>But we have another practical issue remaining. Names are not reliable identifier, multiple patients could have the same name. So, we need to handle it correctly using a patient id.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Patient model with manual ID</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory DB</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> pd.DataFrame({</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'patient_id'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'int'</span>),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'weight'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'float'</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> db[<span class="st">'patient_id'</span>].eq(patient.patient_id).<span class="bu">any</span>():</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> pd.DataFrame([patient.model_dump()])</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> pd.concat([db, new_row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> db.index[db[<span class="st">'patient_id'</span>] <span class="op">==</span> patient.patient_id].tolist()</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> idx:</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    db.loc[idx[<span class="dv">0</span>], [<span class="st">'name'</span>, <span class="st">'age'</span>, <span class="st">'weight'</span>]] <span class="op">=</span> patient.name, patient.age, patient.weight</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Test it</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add 2 patients manually</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P001'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">29</span>, weight<span class="op">=</span><span class="dv">55</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P002'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">40</span>, weight<span class="op">=</span><span class="dv">70</span>)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Attempt duplicate insert</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update patient1</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P001'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">30</span>, weight<span class="op">=</span><span class="fl">56.5</span>)</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Inserted patient: Rashed with ID: P001
Inserted patient: Rashed with ID: P002
Patient ID 'P001' already exists. Use update instead.
Updated patient: Rashed with ID: P001</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Show DB</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
Current Database:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>  patient_id    name  age  weight
0       P001  Rashed   30    56.5
1       P002  Rashed   40    70.0</code></pre>
</div>
</div>
<p>Let’s make a bit more complex model. We are going to add more fields having more than one entry. So, pandas dataframe is not a good choice. We will use json data format instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Patient model</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    married: <span class="bu">bool</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    allergies: List[<span class="bu">str</span>]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    contact_info: Dict[<span class="bu">str</span>, <span class="bu">str</span>]</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory "DB"</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>db: List[Patient] <span class="op">=</span> []</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(p.patient_id <span class="op">==</span> patient.patient_id <span class="cf">for</span> p <span class="kw">in</span> db):</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    db.append(patient)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, p <span class="kw">in</span> <span class="bu">enumerate</span>(db):</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.patient_id <span class="op">==</span> patient.patient_id:</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>            db[idx] <span class="op">=</span> patient</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Save/Load to/from JSON</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_db_to_json(filepath<span class="op">=</span><span class="st">"patients.json"</span>):</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>        json.dump([p.model_dump() <span class="cf">for</span> p <span class="kw">in</span> db], f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Database saved to JSON."</span>)</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_db_from_json(filepath<span class="op">=</span><span class="st">"patients.json"</span>):</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> json.load(f)</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>            db <span class="op">=</span> [Patient(<span class="op">**</span>p) <span class="cf">for</span> p <span class="kw">in</span> data]</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Database loaded from JSON."</span>)</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No existing database found."</span>)</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Validation error while loading:"</span>, e)</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Test it</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>    load_db_from_json()</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">29</span>,</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">55</span>,</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+492648973'</span>, <span class="st">'email'</span>: <span class="st">'abcrashed@gmail.com'</span>}</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(</span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P002'</span>,</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">70</span>,</span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Pollen'</span>],</span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49663882'</span>, <span class="st">'email'</span>: <span class="st">'rashed@gmail.com'</span>}</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)  <span class="co"># Duplicate test</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update</span></span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">56.7</span>,</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+492648973'</span>, <span class="st">'email'</span>: <span class="st">'abcrashed@gmail.com'</span>}</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>    save_db_to_json()</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>Database loaded from JSON.
Patient ID 'P001' already exists. Use update instead.
Patient ID 'P002' already exists. Use update instead.
Patient ID 'P001' already exists. Use update instead.
Updated patient: Rashed with ID: P001
Database saved to JSON.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Show database</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database (in-memory):"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
Current Database (in-memory):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(patient.model_dump())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>{'patient_id': 'P001', 'name': 'Rashed', 'age': 30, 'weight': 56.7, 'married': True, 'allergies': ['Dust', 'Pollen'], 'contact_info': {'phone': '+492648973', 'email': 'abcrashed@gmail.com'}}
{'patient_id': 'P002', 'name': 'Rashed', 'age': 40, 'weight': 70.0, 'married': True, 'allergies': ['Pollen'], 'contact_info': {'phone': '+49663882', 'email': 'rashed@gmail.com'}}</code></pre>
</div>
</div>
<p>Why did not we use <code>list</code> and <code>dict</code> though? Because, we could make sure that the fields are list and string, but we could not check the data types inside those list or dict. That’s why we used 2-step validation using <code>List[str]</code> and <code>Dict[str, str]</code>.</p>
<p>We could make our model more flexible. For example, not every patient will have allergies, but that field is required now! Let’s work around that.</p>
<section id="making-fields-optional-and-adding-validation" class="level2"><h2 class="anchored" data-anchor-id="making-fields-optional-and-adding-validation">Making Fields Optional and Adding Validation</h2>
<p>In real-world applications, not all fields are required. Let’s make our model more realistic by adding optional fields and custom validation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError, Field, validator</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Optional</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Enhanced Patient model with optional fields and validation</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span> <span class="op">=</span> Field(..., min_length<span class="op">=</span><span class="dv">4</span>, max_length<span class="op">=</span><span class="dv">10</span>, description<span class="op">=</span><span class="st">"Unique patient identifier"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(..., min_length<span class="op">=</span><span class="dv">2</span>, max_length<span class="op">=</span><span class="dv">50</span>, description<span class="op">=</span><span class="st">"Patient full name"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span> <span class="op">=</span> Field(..., ge<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">150</span>, description<span class="op">=</span><span class="st">"Patient age in years"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span> <span class="op">=</span> Field(..., gt<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">500</span>, description<span class="op">=</span><span class="st">"Patient weight in kg"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    height: Optional[<span class="bu">float</span>] <span class="op">=</span> Field(<span class="va">None</span>, gt<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">300</span>, description<span class="op">=</span><span class="st">"Patient height in cm"</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    married: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>  <span class="co"># Default value</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    allergies: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> Field(default<span class="op">=</span>[], description<span class="op">=</span><span class="st">"List of known allergies"</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    contact_info: Dict[<span class="bu">str</span>, <span class="bu">str</span>] <span class="op">=</span> Field(default_factory<span class="op">=</span><span class="bu">dict</span>, description<span class="op">=</span><span class="st">"Contact information"</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    emergency_contact: Optional[Dict[<span class="bu">str</span>, <span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    blood_type: Optional[<span class="bu">str</span>] <span class="op">=</span> Field(<span class="va">None</span>, regex<span class="op">=</span><span class="vs">r'^(A|B|AB|O)[+-]</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="er">, description="Blood type (e.g., A+, O-, AB+)")</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom validator for name formatting</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@validator</span>(<span class="st">'name'</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> name_must_not_be_empty_or_just_spaces(cls, v):</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> v.strip():</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Name cannot be empty or just spaces'</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v.strip().title()  <span class="co"># Capitalize properly</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom validator for phone number in contact_info</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">@validator</span>(<span class="st">'contact_info'</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate_contact_info(cls, v):</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'phone'</span> <span class="kw">in</span> v:</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>            phone <span class="op">=</span> v[<span class="st">'phone'</span>]</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Simple phone validation (starts with + and has digits)</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> phone.startswith(<span class="st">'+'</span>) <span class="kw">or</span> <span class="kw">not</span> phone[<span class="dv">1</span>:].replace(<span class="st">'-'</span>, <span class="st">''</span>).replace(<span class="st">' '</span>, <span class="st">''</span>).isdigit():</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Phone number must start with + and contain valid digits'</span>)</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate BMI if height is provided</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_bmi(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">float</span>]:</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.height:</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>            height_m <span class="op">=</span> <span class="va">self</span>.height <span class="op">/</span> <span class="dv">100</span>  <span class="co"># Convert cm to meters</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">round</span>(<span class="va">self</span>.weight <span class="op">/</span> (height_m <span class="op">**</span> <span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if patient is adult</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_adult(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.age <span class="op">&gt;=</span> <span class="dv">18</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get formatted patient info</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_summary(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>        bmi <span class="op">=</span> <span class="va">self</span>.calculate_bmi()</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>        bmi_str <span class="op">=</span> <span class="ss">f", BMI: </span><span class="sc">{</span>bmi<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> bmi <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>        allergies_str <span class="op">=</span> <span class="ss">f", Allergies: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(<span class="va">self</span>.allergies)<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> <span class="va">self</span>.allergies <span class="cf">else</span> <span class="st">", No known allergies"</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (ID: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">), Age: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>age<span class="sc">}</span><span class="ss">, Weight: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>weight<span class="sc">}</span><span class="ss">kg</span><span class="sc">{</span>bmi_str<span class="sc">}{</span>allergies_str<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Enhanced database operations</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>db: List[Patient] <span class="op">=</span> []</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(p.patient_id <span class="op">==</span> patient.patient_id <span class="cf">for</span> p <span class="kw">in</span> db):</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>    db.append(patient)</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✅ Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, p <span class="kw">in</span> <span class="bu">enumerate</span>(db):</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.patient_id <span class="op">==</span> patient.patient_id:</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>            db[idx] <span class="op">=</span> patient</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"✅ Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_patient_by_id(patient_id: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[Patient]:</span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.patient_id <span class="op">==</span> patient_id:</span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> patient</span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_all_patients():</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> db:</span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"📭 No patients in database."</span>)</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">👥 All Patients (</span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> total):"</span>)</span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"🏥 </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.blood_type:</span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   🩸 Blood Type: </span><span class="sc">{</span>patient<span class="sc">.</span>blood_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.contact_info:</span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>            contact_str <span class="op">=</span> <span class="st">", "</span>.join([<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k, v <span class="kw">in</span> patient.contact_info.items()])</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   📞 Contact: </span><span class="sc">{</span>contact_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_patients_by_age_range(min_age: <span class="bu">int</span>, max_age: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Patient]:</span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> min_age <span class="op">&lt;=</span> p.age <span class="op">&lt;=</span> max_age]</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_patients_with_allergies() <span class="op">-&gt;</span> List[Patient]:</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> p.allergies]</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Test the enhanced system</span></span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"🏥 Testing Enhanced Patient Management System"</span>)</span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 1: Valid patient with all fields</span></span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 1: Complete patient record"</span>)</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(</span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'   rashed uzzaman   '</span>,  <span class="co"># Will be cleaned and capitalized</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">29</span>,</span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">65.5</span>,</span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">175</span>,</span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>, <span class="st">'Cats'</span>],</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-123-456789'</span>, <span class="st">'email'</span>: <span class="st">'rashed@email.com'</span>},</span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a>        emergency_contact<span class="op">=</span>{<span class="st">'name'</span>: <span class="st">'Jane Doe'</span>, <span class="st">'phone'</span>: <span class="st">'+49-987-654321'</span>},</span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'O+'</span></span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   BMI: </span><span class="sc">{</span>patient1<span class="sc">.</span>calculate_bmi()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Adult: </span><span class="sc">{</span>patient1<span class="sc">.</span>is_adult()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 2: Minimal patient record (using defaults)</span></span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 2: Minimal patient record"</span>)</span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(</span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P002'</span>,</span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Alice Johnson'</span>,</span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">35</span>,</span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">58.2</span></span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 3: Child patient</span></span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 3: Child patient"</span>)</span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a>    patient3 <span class="op">=</span> Patient(</span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P003'</span>,</span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Bobby Smith'</span>,</span>
<span id="cb40-149"><a href="#cb40-149" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb40-150"><a href="#cb40-150" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">40.0</span>,</span>
<span id="cb40-151"><a href="#cb40-151" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb40-152"><a href="#cb40-152" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Peanuts'</span>],</span>
<span id="cb40-153"><a href="#cb40-153" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-555-123456'</span>},</span>
<span id="cb40-154"><a href="#cb40-154" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'A-'</span></span>
<span id="cb40-155"><a href="#cb40-155" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-156"><a href="#cb40-156" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient3)</span>
<span id="cb40-157"><a href="#cb40-157" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Adult: </span><span class="sc">{</span>patient3<span class="sc">.</span>is_adult()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-158"><a href="#cb40-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-159"><a href="#cb40-159" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 4: Try to insert duplicate</span></span>
<span id="cb40-160"><a href="#cb40-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 4: Duplicate insertion attempt"</span>)</span>
<span id="cb40-161"><a href="#cb40-161" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb40-162"><a href="#cb40-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-163"><a href="#cb40-163" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 5: Update patient</span></span>
<span id="cb40-164"><a href="#cb40-164" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 5: Update patient weight"</span>)</span>
<span id="cb40-165"><a href="#cb40-165" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(</span>
<span id="cb40-166"><a href="#cb40-166" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb40-167"><a href="#cb40-167" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed Uzzaman'</span>,</span>
<span id="cb40-168"><a href="#cb40-168" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">30</span>,  <span class="co"># Birthday!</span></span>
<span id="cb40-169"><a href="#cb40-169" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">67.0</span>,  <span class="co"># Gained weight</span></span>
<span id="cb40-170"><a href="#cb40-170" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">175</span>,</span>
<span id="cb40-171"><a href="#cb40-171" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb40-172"><a href="#cb40-172" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],  <span class="co"># No longer allergic to cats!</span></span>
<span id="cb40-173"><a href="#cb40-173" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-123-456789'</span>, <span class="st">'email'</span>: <span class="st">'rashed.new@email.com'</span>},</span>
<span id="cb40-174"><a href="#cb40-174" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'O+'</span></span>
<span id="cb40-175"><a href="#cb40-175" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-176"><a href="#cb40-176" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb40-177"><a href="#cb40-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-178"><a href="#cb40-178" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb40-179"><a href="#cb40-179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Validation Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-180"><a href="#cb40-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-181"><a href="#cb40-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all patients</span></span>
<span id="cb40-182"><a href="#cb40-182" aria-hidden="true" tabindex="-1"></a>list_all_patients()</span>
<span id="cb40-183"><a href="#cb40-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-184"><a href="#cb40-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Query examples</span></span>
<span id="cb40-185"><a href="#cb40-185" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🔍 Query Examples:"</span>)</span>
<span id="cb40-186"><a href="#cb40-186" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb40-187"><a href="#cb40-187" aria-hidden="true" tabindex="-1"></a>adults <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> p.is_adult()]</span>
<span id="cb40-188"><a href="#cb40-188" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"👨‍👩‍👧‍👦 Adult patients: </span><span class="sc">{</span><span class="bu">len</span>(adults)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-189"><a href="#cb40-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-190"><a href="#cb40-190" aria-hidden="true" tabindex="-1"></a>patients_with_allergies <span class="op">=</span> get_patients_with_allergies()</span>
<span id="cb40-191"><a href="#cb40-191" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🤧 Patients with allergies: </span><span class="sc">{</span><span class="bu">len</span>(patients_with_allergies)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-192"><a href="#cb40-192" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> patients_with_allergies:</span>
<span id="cb40-193"><a href="#cb40-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - </span><span class="sc">{</span>p<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(p.allergies)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-194"><a href="#cb40-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-195"><a href="#cb40-195" aria-hidden="true" tabindex="-1"></a>young_adults <span class="op">=</span> get_patients_by_age_range(<span class="dv">18</span>, <span class="dv">30</span>)</span>
<span id="cb40-196"><a href="#cb40-196" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🧑 Young adults (18-30): </span><span class="sc">{</span><span class="bu">len</span>(young_adults)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb40-197"><a href="#cb40-197" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> young_adults:</span>
<span id="cb40-198"><a href="#cb40-198" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - </span><span class="sc">{</span>p<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>p<span class="sc">.</span>age<span class="sc">}</span><span class="ss"> years old)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>unterminated string literal (detected at line 19) (&lt;string&gt;, line 19)</code></pre>
</div>
</div>
</section><section id="advanced-validation-with-custom-validators" class="level2"><h2 class="anchored" data-anchor-id="advanced-validation-with-custom-validators">Advanced Validation with Custom Validators</h2>
<p>Now let’s see what happens when we try to insert invalid data. Pydantic will catch these errors and give us helpful messages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🚨 Testing Validation Errors"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test invalid data scenarios</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>test_cases <span class="op">=</span> [</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Age Test'</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P999'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="op">-</span><span class="dv">5</span>, <span class="st">'weight'</span>: <span class="dv">70</span>},</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Age cannot be negative'</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Weight Test'</span>, </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P998'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">0</span>},</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Weight must be greater than 0'</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Blood Type Test'</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P997'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>, <span class="st">'blood_type'</span>: <span class="st">'XYZ'</span>},</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Invalid blood type format'</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Phone Number Test'</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P996'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>, <span class="st">'contact_info'</span>: {<span class="st">'phone'</span>: <span class="st">'invalid-phone'</span>}},</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Invalid phone number format'</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Empty Name Test'</span>,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P995'</span>, <span class="st">'name'</span>: <span class="st">'   '</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>},</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Name cannot be empty'</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> test <span class="kw">in</span> test_cases:</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🧪 </span><span class="sc">{</span>test[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>        invalid_patient <span class="op">=</span> Patient(<span class="op">**</span>test[<span class="st">'data'</span>])</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ⚠️ Unexpectedly succeeded: </span><span class="sc">{</span>invalid_patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ✅ Correctly caught error: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">.</span>split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ❌ Unexpected error type: </span><span class="sc">{</span><span class="bu">type</span>(e)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>f-string expression part cannot include a backslash (&lt;string&gt;, line 39)</code></pre>
</div>
</div>
</section><section id="real-world-data-processing-with-pydantic" class="level2"><h2 class="anchored" data-anchor-id="real-world-data-processing-with-pydantic">Real-World Data Processing with Pydantic</h2>
<p>Let’s simulate reading patient data from a CSV file and using Pydantic to validate and clean it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate CSV data (in real world, you'd read from a file)</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>csv_data <span class="op">=</span> <span class="st">"""patient_id,name,age,weight,height,married,allergies,phone,email,blood_type</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="st">P101,john doe,25,70.5,180,true,"Dust,Pollen",+49-111-222333,john@email.com,A+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="st">P102,JANE SMITH,35,65.0,,false,Peanuts,+49-444-555666,jane@email.com,O-</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="st">P103,bob wilson,17,55.2,165,false,,+49-777-888999,bob@email.com,</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="st">P104,invalid patient,-5,0,200,maybe,Bad Data,invalid-phone,not-an-email,XYZ</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="st">P105,mary johnson,45,72.3,168,true,"Shellfish,Latex",+49-123-987654,mary@email.com,B+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_csv_data(csv_content: <span class="bu">str</span>):</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Process CSV data and create Patient objects with validation"""</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    successful_patients <span class="op">=</span> []</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    failed_records <span class="op">=</span> []</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(StringIO(csv_content))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row_num, row <span class="kw">in</span> <span class="bu">enumerate</span>(csv_reader, <span class="dv">1</span>):</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clean and prepare data</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>            processed_row <span class="op">=</span> {</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">'patient_id'</span>: row[<span class="st">'patient_id'</span>].strip(),</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">'name'</span>: row[<span class="st">'name'</span>].strip(),</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">'age'</span>: <span class="bu">int</span>(row[<span class="st">'age'</span>]),</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">'weight'</span>: <span class="bu">float</span>(row[<span class="st">'weight'</span>]),</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">'married'</span>: row[<span class="st">'married'</span>].lower() <span class="kw">in</span> [<span class="st">'true'</span>, <span class="st">'1'</span>, <span class="st">'yes'</span>],</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle optional fields</span></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'height'</span>].strip():</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'height'</span>] <span class="op">=</span> <span class="bu">float</span>(row[<span class="st">'height'</span>])</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process allergies (split by comma if present)</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'allergies'</span>].strip():</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'allergies'</span>] <span class="op">=</span> [a.strip() <span class="cf">for</span> a <span class="kw">in</span> row[<span class="st">'allergies'</span>].split(<span class="st">','</span>)]</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Build contact info</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>            contact_info <span class="op">=</span> {}</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'phone'</span>].strip():</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>                contact_info[<span class="st">'phone'</span>] <span class="op">=</span> row[<span class="st">'phone'</span>].strip()</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'email'</span>].strip():</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>                contact_info[<span class="st">'email'</span>] <span class="op">=</span> row[<span class="st">'email'</span>].strip()</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contact_info:</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'contact_info'</span>] <span class="op">=</span> contact_info</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood type</span></span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'blood_type'</span>].strip():</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'blood_type'</span>] <span class="op">=</span> row[<span class="st">'blood_type'</span>].strip()</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create Patient object (this will validate everything)</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>            patient <span class="op">=</span> Patient(<span class="op">**</span>processed_row)</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>            successful_patients.append(patient)</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"✅ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Successfully processed </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>            error_msg <span class="op">=</span> <span class="bu">str</span>(e).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">0</span>]  <span class="co"># Get first error line</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>            failed_records.append({<span class="st">'row'</span>: row_num, <span class="st">'data'</span>: row, <span class="st">'error'</span>: error_msg})</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"❌ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Validation failed - </span><span class="sc">{</span>error_msg<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>            failed_records.append({<span class="st">'row'</span>: row_num, <span class="st">'data'</span>: row, <span class="st">'error'</span>: <span class="bu">str</span>(e)})</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"❌ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Processing failed - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> successful_patients, failed_records</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📊 Processing CSV Data with Pydantic Validation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
📊 Processing CSV Data with Pydantic Validation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">55</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>=======================================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>successful, failed <span class="op">=</span> process_csv_data(csv_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>✅ Row 1: Successfully processed john doe
✅ Row 2: Successfully processed JANE SMITH
❌ Row 3: Validation failed - 1 validation error for Patient
✅ Row 4: Successfully processed invalid patient
✅ Row 5: Successfully processed mary johnson</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📈 Summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
📈 Summary:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✅ Successfully processed: </span><span class="sc">{</span><span class="bu">len</span>(successful)<span class="sc">}</span><span class="ss"> patients"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>✅ Successfully processed: 4 patients</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"❌ Failed to process: </span><span class="sc">{</span><span class="bu">len</span>(failed)<span class="sc">}</span><span class="ss"> records"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>❌ Failed to process: 1 records</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> successful:</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">👥 Successfully Imported Patients:"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> successful:</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   🏥 </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>AttributeError: 'Patient' object has no attribute 'get_summary'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> failed:</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️ Failed Records (need manual review):"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> failure <span class="kw">in</span> failed:</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   Row </span><span class="sc">{</span>failure[<span class="st">'row'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>failure[<span class="st">'data'</span>][<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>failure[<span class="st">'error'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
⚠️ Failed Records (need manual review):
   Row 3: bob wilson - 1 validation error for Patient</code></pre>
</div>
</div>
</section><section id="saving-and-loading-with-json-schema" class="level2"><h2 class="anchored" data-anchor-id="saving-and-loading-with-json-schema">Saving and Loading with JSON Schema</h2>
<p>Pydantic can also generate JSON schemas and work seamlessly with JSON data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate JSON schema for our Patient model</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>patient_schema <span class="op">=</span> Patient.model_json_schema()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"📋 Patient Model JSON Schema:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>📋 Patient Model JSON Schema:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>===================================</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(patient_schema, indent<span class="op">=</span><span class="dv">2</span>)[:<span class="dv">500</span>] <span class="op">+</span> <span class="st">"...</span><span class="ch">\n</span><span class="st">(truncated)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>{
  "properties": {
    "patient_id": {
      "title": "Patient Id",
      "type": "string"
    },
    "name": {
      "title": "Name",
      "type": "string"
    },
    "age": {
      "title": "Age",
      "type": "integer"
    },
    "weight": {
      "title": "Weight",
      "type": "number"
    },
    "married": {
      "title": "Married",
      "type": "boolean"
    },
    "allergies": {
      "items": {
        "type": "string"
      },
      "title": "Allergies",
      "type": "array"
   ...
(truncated)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save all our patients to JSON with timestamp</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_patients_with_metadata(filename: <span class="bu">str</span> <span class="op">=</span> <span class="st">"patients_database.json"</span>):</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'timestamp'</span>: datetime.now().isoformat(),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_patients'</span>: <span class="bu">len</span>(db),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'schema_version'</span>: <span class="st">'1.0'</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'patients'</span>: [patient.model_dump() <span class="cf">for</span> patient <span class="kw">in</span> db]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        json.dump(data, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"💾 Saved </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filename</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Load patients from JSON with validation</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_patients_with_validation(filename: <span class="bu">str</span> <span class="op">=</span> <span class="st">"patients_database.json"</span>):</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> json.load(f)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"📖 Loading database from </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   📅 Saved on: </span><span class="sc">{</span>data[<span class="st">'timestamp'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   👥 Expected patients: </span><span class="sc">{</span>data[<span class="st">'total_patients'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate and load each patient</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>        loaded_patients <span class="op">=</span> []</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> patient_data <span class="kw">in</span> data[<span class="st">'patients'</span>]:</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>                patient <span class="op">=</span> Patient(<span class="op">**</span>patient_data)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>                loaded_patients.append(patient)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"   ❌ Failed to load patient </span><span class="sc">{</span>patient_data<span class="sc">.</span>get(<span class="st">'name'</span>, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        db <span class="op">=</span> loaded_patients</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ✅ Successfully loaded </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients"</span>)</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ File </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> not found"</span>)</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError <span class="im">as</span> e:</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Error loading database: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Save current database</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> save_patients_with_metadata()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>💾 Saved 2 patients to patients_database.json</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear database and reload to test</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>original_db <span class="op">=</span> db.copy()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> []</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🗑️ Cleared database (now has </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
🗑️ Cleared database (now has 0 patients)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>load_patients_with_validation(filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>📖 Loading database from patients_database.json
   📅 Saved on: 2025-09-26T21:19:32.325143
   👥 Expected patients: 2
   ✅ Successfully loaded 2 patients</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🔄 Reloaded database (now has </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>🔄 Reloaded database (now has 2 patients)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify data integrity</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔍 Data Integrity Check:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>
🔍 Data Integrity Check:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(original_db) <span class="op">==</span> <span class="bu">len</span>(db):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✅ Patient count matches"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> orig, loaded <span class="kw">in</span> <span class="bu">zip</span>(original_db, db):</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> orig.model_dump() <span class="op">==</span> loaded.model_dump():</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ✅ </span><span class="sc">{</span>orig<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> data matches perfectly"</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ❌ </span><span class="sc">{</span>orig<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> data mismatch detected"</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Patient count mismatch: original </span><span class="sc">{</span><span class="bu">len</span>(original_db)<span class="sc">}</span><span class="ss">, loaded </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre class="custom-output"><code>✅ Patient count matches
   ✅ Rashed data matches perfectly
   ✅ Rashed data matches perfectly</code></pre>
</div>
</div>
</section><section id="summary-the-power-of-pydantic" class="level2"><h2 class="anchored" data-anchor-id="summary-the-power-of-pydantic">Summary: The Power of Pydantic</h2>
<p>Throughout this journey, we’ve seen how Pydantic transforms our approach to data handling:</p>
<section id="key-benefits-weve-demonstrated" class="level3"><h3 class="anchored" data-anchor-id="key-benefits-weve-demonstrated">🎯 <strong>Key Benefits We’ve Demonstrated:</strong>
</h3>
<ol type="1">
<li>
<strong>🛡️ Automatic Validation</strong>: No more manual type checking - Pydantic does it automatically</li>
<li>
<strong>🔄 Type Coercion</strong>: Smart conversion of compatible types (string “55” → float 55.0)</li>
<li>
<strong>📝 Clear Error Messages</strong>: Helpful validation errors that pinpoint exactly what’s wrong</li>
<li>
<strong>🎨 Clean Code</strong>: Models serve as documentation and enforce data contracts</li>
<li>
<strong>🔧 Flexibility</strong>: Optional fields, default values, and custom validators</li>
<li>
<strong>🌐 JSON Integration</strong>: Seamless serialization/deserialization with validation</li>
<li>
<strong>📊 Real-world Ready</strong>: Handles complex data scenarios like CSV imports</li>
</ol></section><section id="from-simple-to-sophisticated" class="level3"><h3 class="anchored" data-anchor-id="from-simple-to-sophisticated">🚀 <strong>From Simple to Sophisticated:</strong>
</h3>
<ul>
<li>Started with basic type hints (limited enforcement)</li>
<li>Added manual validation (not scalable)</li>
<li>Introduced Pydantic models (automatic validation)</li>
<li>Enhanced with optional fields and custom validators</li>
<li>Integrated with real data processing (CSV, JSON)</li>
<li>Built a complete data management system</li>
</ul></section><section id="when-to-use-pydantic" class="level3"><h3 class="anchored" data-anchor-id="when-to-use-pydantic">💡 <strong>When to Use Pydantic:</strong>
</h3>
<ul>
<li>
<strong>API Development</strong>: Validate request/response data</li>
<li>
<strong>Data Processing</strong>: Clean and validate CSV/JSON imports</li>
<li>
<strong>Configuration Management</strong>: Validate application settings</li>
<li>
<strong>Database Models</strong>: Ensure data integrity before persistence</li>
<li>
<strong>Microservices</strong>: Validate inter-service communication</li>
</ul>
<p>Pydantic transforms unreliable, error-prone data handling into robust, self-documenting, and maintainable code. It’s not just about validation - it’s about building confidence in your data throughout your entire application! 🎉</p>


<!-- -->

</section></section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{rasheduzzaman2025,
  author = {Md Rasheduzzaman},
  title = {Panda {Dataframe,} Scypy, Numpy, Data Typing, Etc.},
  date = {2025-09-26},
  langid = {en},
  abstract = {Pydantic}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-rasheduzzaman2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Md Rasheduzzaman. 2025. <span>“Panda Dataframe, Scypy, Numpy, Data
Typing, Etc.”</span> September 26, 2025.
</div></div></section></div></main><!-- /main --><hr>
<div style="margin-top: 2em;">
  <p style="font-weight: 500; font-size: 1.1em;">
    💬 Have thoughts or questions? Join the discussion below using your GitHub account!
  </p>
  <p style="font-size: 0.95em; color: #666;">
    You can <strong>edit or delete</strong> your own comments. Reactions like 👍 ❤️ 🚀 are also supported.
  </p>
</div>

<div id="giscus_thread" style="margin-top: 1.5em;"></div>

<script src="https://giscus.app/client.js" data-repo="MdRasheduz-zaman/PythRaSh" data-repo-id="R_kgDOOZN9Xw" data-category-id="DIC_kwDOOZN9X84CpE6N" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" data-loading="lazy" crossorigin="anonymous" async="">
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb78" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Panda Dataframe, scypy, numpy, data typing, etc."</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> "Pydantic"</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"src/helpersrc.R"</span>))</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="fu"># Dynamic data type</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>Data typing in python: It is dynamic in python. But we can put some hints to help users with their input. But still, it can be problematic. See below:</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(name)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(age)</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"thirty"</span>)</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>You see, nobody is stopping the user to put age as a string. A better way would be to keep a check on the data type using loop. If the data type doesn't match, we will raise an error.</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">30</span>)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"thirty"</span>)</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>We see a data type error here, so our system works to catch it.</span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>But this way is not scalable. Let's work around it.</span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"inserted into the DB"</span>)</span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(age)</span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Updated"</span>)</span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">30</span>)</span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>update_patient_data(<span class="st">"Rashed"</span>, <span class="dv">29</span>)</span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>You see the issue with scalability? How many times will we do it if we have more functions using these variables? Data validation is also very important for us for better control. In the above example, we could put <span class="in">`-10`</span> as age, it would pass the data type check, there is no stopping. But is it meaningful? So, we could say <span class="in">`age`</span> can not be less than 0. How to do it?</span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-83"><a href="#cb78-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-84"><a href="#cb78-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(name: <span class="bu">str</span>, age: <span class="bu">int</span>):</span>
<span id="cb78-85"><a href="#cb78-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">type</span>(name)<span class="op">==</span><span class="bu">str</span> <span class="kw">and</span> <span class="bu">type</span>(age)<span class="op">==</span><span class="bu">int</span>:</span>
<span id="cb78-86"><a href="#cb78-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> age <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb78-87"><a href="#cb78-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Age cannot be less than 0"</span>)</span>
<span id="cb78-88"><a href="#cb78-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb78-89"><a href="#cb78-89" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(name)</span>
<span id="cb78-90"><a href="#cb78-90" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(age)</span>
<span id="cb78-91"><a href="#cb78-91" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"Inserted into the DB"</span>)</span>
<span id="cb78-92"><a href="#cb78-92" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb78-93"><a href="#cb78-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">"Incorrect data type"</span>)</span>
<span id="cb78-94"><a href="#cb78-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-95"><a href="#cb78-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-96"><a href="#cb78-96" aria-hidden="true" tabindex="-1"></a>Now, let's check.</span>
<span id="cb78-97"><a href="#cb78-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-100"><a href="#cb78-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-101"><a href="#cb78-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-102"><a href="#cb78-102" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="dv">10</span>)</span>
<span id="cb78-103"><a href="#cb78-103" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="op">-</span><span class="dv">10</span>)</span>
<span id="cb78-104"><a href="#cb78-104" aria-hidden="true" tabindex="-1"></a>insert_patient_data(<span class="st">"Rashed"</span>, <span class="st">"10"</span>)</span>
<span id="cb78-105"><a href="#cb78-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-106"><a href="#cb78-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-107"><a href="#cb78-107" aria-hidden="true" tabindex="-1"></a>Here comes <span class="in">`Pydantic`</span> to help us checking for </span>
<span id="cb78-108"><a href="#cb78-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-109"><a href="#cb78-109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data type, and</span>
<span id="cb78-110"><a href="#cb78-110" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data validation</span>
<span id="cb78-111"><a href="#cb78-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-112"><a href="#cb78-112" aria-hidden="true" tabindex="-1"></a>And it does so in 3 steps:  </span>
<span id="cb78-113"><a href="#cb78-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-114"><a href="#cb78-114" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>1. **Define a Pydantic model (class)** representing the **ideal schema**. This includes the expected fields, their data types and any validation constraint (e.g. <span class="in">`lt=0`</span> for negative numbers)  </span>
<span id="cb78-115"><a href="#cb78-115" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>2. **Instantiate the model with raw input data** or make a Pydantic object (usually a dictionary or JSON-like structure) </span>
<span id="cb78-116"><a href="#cb78-116" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Pydantic will automatically **validate** the data and **coerce** it into the correct Python types (if possible)  </span>
<span id="cb78-117"><a href="#cb78-117" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>If the data doesn't meet the model's criteria, Pydantic raise a <span class="in">`ValidationError`</span>.  </span>
<span id="cb78-118"><a href="#cb78-118" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>3. Pass the validated model object to functions or use it throughout your codebase. </span>
<span id="cb78-119"><a href="#cb78-119" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>This ensures that every part of your program works with **clean, type-safe, and logically valid data**.</span>
<span id="cb78-120"><a href="#cb78-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-121"><a href="#cb78-121" aria-hidden="true" tabindex="-1"></a>Let's use it now. But let's make the example more realistic. We will make a dataframe with the required fields using pandas first. Then we will insert a patient info into that dataframe if the patient is new. If not, we will update information for that patient.</span>
<span id="cb78-122"><a href="#cb78-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-125"><a href="#cb78-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-126"><a href="#cb78-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-127"><a href="#cb78-127" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb78-128"><a href="#cb78-128" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb78-129"><a href="#cb78-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-130"><a href="#cb78-130" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-131"><a href="#cb78-131" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define the model</span></span>
<span id="cb78-132"><a href="#cb78-132" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-133"><a href="#cb78-133" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb78-134"><a href="#cb78-134" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb78-135"><a href="#cb78-135" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb78-136"><a href="#cb78-136" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb78-137"><a href="#cb78-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-138"><a href="#cb78-138" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-139"><a href="#cb78-139" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory database</span></span>
<span id="cb78-140"><a href="#cb78-140" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-141"><a href="#cb78-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame to store patient records</span></span>
<span id="cb78-142"><a href="#cb78-142" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> pd.DataFrame({</span>
<span id="cb78-143"><a href="#cb78-143" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb78-144"><a href="#cb78-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'int'</span>),</span>
<span id="cb78-145"><a href="#cb78-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">'weight'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'float'</span>)</span>
<span id="cb78-146"><a href="#cb78-146" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb78-147"><a href="#cb78-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-148"><a href="#cb78-148" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-149"><a href="#cb78-149" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb78-150"><a href="#cb78-150" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-151"><a href="#cb78-151" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb78-152"><a href="#cb78-152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-153"><a href="#cb78-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if patient already exists by name</span></span>
<span id="cb78-154"><a href="#cb78-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> db[<span class="st">'name'</span>].eq(patient.name).<span class="bu">any</span>():</span>
<span id="cb78-155"><a href="#cb78-155" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient '</span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb78-156"><a href="#cb78-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-157"><a href="#cb78-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-158"><a href="#cb78-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append new patient</span></span>
<span id="cb78-159"><a href="#cb78-159" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> pd.concat([db, pd.DataFrame([patient.model_dump()])], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-160"><a href="#cb78-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-161"><a href="#cb78-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-162"><a href="#cb78-162" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-163"><a href="#cb78-163" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb78-164"><a href="#cb78-164" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-165"><a href="#cb78-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb78-166"><a href="#cb78-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-167"><a href="#cb78-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find index of the patient by name</span></span>
<span id="cb78-168"><a href="#cb78-168" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> db.index[db[<span class="st">'name'</span>] <span class="op">==</span> patient.name].tolist()</span>
<span id="cb78-169"><a href="#cb78-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> idx:</span>
<span id="cb78-170"><a href="#cb78-170" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient '</span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb78-171"><a href="#cb78-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-172"><a href="#cb78-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-173"><a href="#cb78-173" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the record</span></span>
<span id="cb78-174"><a href="#cb78-174" aria-hidden="true" tabindex="-1"></a>    db.loc[idx[<span class="dv">0</span>], [<span class="st">'age'</span>, <span class="st">'weight'</span>]] <span class="op">=</span> patient.age, patient.weight</span>
<span id="cb78-175"><a href="#cb78-175" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-176"><a href="#cb78-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-177"><a href="#cb78-177" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-178"><a href="#cb78-178" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Test the system</span></span>
<span id="cb78-179"><a href="#cb78-179" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-180"><a href="#cb78-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial insert</span></span>
<span id="cb78-181"><a href="#cb78-181" aria-hidden="true" tabindex="-1"></a>patient_info <span class="op">=</span> {<span class="st">'name'</span>: <span class="st">'Rashed'</span>, <span class="st">'age'</span>: <span class="dv">29</span>, <span class="st">'weight'</span>: <span class="st">'55'</span>}</span>
<span id="cb78-182"><a href="#cb78-182" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb78-183"><a href="#cb78-183" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(<span class="op">**</span>patient_info) <span class="co">#unpacking using 2 star signs</span></span>
<span id="cb78-184"><a href="#cb78-184" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-185"><a href="#cb78-185" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-186"><a href="#cb78-186" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span>
<span id="cb78-187"><a href="#cb78-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-188"><a href="#cb78-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to insert again (should warn)</span></span>
<span id="cb78-189"><a href="#cb78-189" aria-hidden="true" tabindex="-1"></a>insert_patient_data(patient1)</span>
<span id="cb78-190"><a href="#cb78-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-191"><a href="#cb78-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Update patient</span></span>
<span id="cb78-192"><a href="#cb78-192" aria-hidden="true" tabindex="-1"></a>updated_info <span class="op">=</span> {<span class="st">'name'</span>: <span class="st">'Rashed'</span>, <span class="st">'age'</span>: <span class="dv">30</span>, <span class="st">'weight'</span>: <span class="fl">57.5</span>}</span>
<span id="cb78-193"><a href="#cb78-193" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb78-194"><a href="#cb78-194" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(<span class="op">**</span>updated_info)</span>
<span id="cb78-195"><a href="#cb78-195" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb78-196"><a href="#cb78-196" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-197"><a href="#cb78-197" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span>
<span id="cb78-198"><a href="#cb78-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-199"><a href="#cb78-199" aria-hidden="true" tabindex="-1"></a><span class="co"># Show database</span></span>
<span id="cb78-200"><a href="#cb78-200" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database:"</span>)</span>
<span id="cb78-201"><a href="#cb78-201" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(db)</span>
<span id="cb78-202"><a href="#cb78-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-203"><a href="#cb78-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-204"><a href="#cb78-204" aria-hidden="true" tabindex="-1"></a>Did you notice something? We put <span class="in">`'weight': '55'`</span> and PyDantic coerced it to float smartly.</span>
<span id="cb78-205"><a href="#cb78-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-206"><a href="#cb78-206" aria-hidden="true" tabindex="-1"></a>But we have another practical issue remaining. Names are not reliable identifier, multiple patients could have the same name. So, we need to handle it correctly using a patient id.</span>
<span id="cb78-207"><a href="#cb78-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-210"><a href="#cb78-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-211"><a href="#cb78-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-212"><a href="#cb78-212" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb78-213"><a href="#cb78-213" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb78-214"><a href="#cb78-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-215"><a href="#cb78-215" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-216"><a href="#cb78-216" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Patient model with manual ID</span></span>
<span id="cb78-217"><a href="#cb78-217" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-218"><a href="#cb78-218" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb78-219"><a href="#cb78-219" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span></span>
<span id="cb78-220"><a href="#cb78-220" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb78-221"><a href="#cb78-221" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb78-222"><a href="#cb78-222" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb78-223"><a href="#cb78-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-224"><a href="#cb78-224" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-225"><a href="#cb78-225" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory DB</span></span>
<span id="cb78-226"><a href="#cb78-226" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-227"><a href="#cb78-227" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> pd.DataFrame({</span>
<span id="cb78-228"><a href="#cb78-228" aria-hidden="true" tabindex="-1"></a>    <span class="st">'patient_id'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb78-229"><a href="#cb78-229" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'str'</span>),</span>
<span id="cb78-230"><a href="#cb78-230" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'int'</span>),</span>
<span id="cb78-231"><a href="#cb78-231" aria-hidden="true" tabindex="-1"></a>    <span class="st">'weight'</span>: pd.Series(dtype<span class="op">=</span><span class="st">'float'</span>)</span>
<span id="cb78-232"><a href="#cb78-232" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb78-233"><a href="#cb78-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-234"><a href="#cb78-234" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-235"><a href="#cb78-235" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb78-236"><a href="#cb78-236" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-237"><a href="#cb78-237" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb78-238"><a href="#cb78-238" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-239"><a href="#cb78-239" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> db[<span class="st">'patient_id'</span>].eq(patient.patient_id).<span class="bu">any</span>():</span>
<span id="cb78-240"><a href="#cb78-240" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb78-241"><a href="#cb78-241" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-242"><a href="#cb78-242" aria-hidden="true" tabindex="-1"></a>    new_row <span class="op">=</span> pd.DataFrame([patient.model_dump()])</span>
<span id="cb78-243"><a href="#cb78-243" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> pd.concat([db, new_row], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-244"><a href="#cb78-244" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-245"><a href="#cb78-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-246"><a href="#cb78-246" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-247"><a href="#cb78-247" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb78-248"><a href="#cb78-248" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-249"><a href="#cb78-249" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb78-250"><a href="#cb78-250" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-251"><a href="#cb78-251" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> db.index[db[<span class="st">'patient_id'</span>] <span class="op">==</span> patient.patient_id].tolist()</span>
<span id="cb78-252"><a href="#cb78-252" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> idx:</span>
<span id="cb78-253"><a href="#cb78-253" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb78-254"><a href="#cb78-254" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-255"><a href="#cb78-255" aria-hidden="true" tabindex="-1"></a>    db.loc[idx[<span class="dv">0</span>], [<span class="st">'name'</span>, <span class="st">'age'</span>, <span class="st">'weight'</span>]] <span class="op">=</span> patient.name, patient.age, patient.weight</span>
<span id="cb78-256"><a href="#cb78-256" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-257"><a href="#cb78-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-258"><a href="#cb78-258" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-259"><a href="#cb78-259" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Test it</span></span>
<span id="cb78-260"><a href="#cb78-260" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-261"><a href="#cb78-261" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb78-262"><a href="#cb78-262" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add 2 patients manually</span></span>
<span id="cb78-263"><a href="#cb78-263" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P001'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">29</span>, weight<span class="op">=</span><span class="dv">55</span>)</span>
<span id="cb78-264"><a href="#cb78-264" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P002'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">40</span>, weight<span class="op">=</span><span class="dv">70</span>)</span>
<span id="cb78-265"><a href="#cb78-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-266"><a href="#cb78-266" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-267"><a href="#cb78-267" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb78-268"><a href="#cb78-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-269"><a href="#cb78-269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Attempt duplicate insert</span></span>
<span id="cb78-270"><a href="#cb78-270" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-271"><a href="#cb78-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-272"><a href="#cb78-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update patient1</span></span>
<span id="cb78-273"><a href="#cb78-273" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(patient_id<span class="op">=</span><span class="st">'P001'</span>, name<span class="op">=</span><span class="st">'Rashed'</span>, age<span class="op">=</span><span class="dv">30</span>, weight<span class="op">=</span><span class="fl">56.5</span>)</span>
<span id="cb78-274"><a href="#cb78-274" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb78-275"><a href="#cb78-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-276"><a href="#cb78-276" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-277"><a href="#cb78-277" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span>
<span id="cb78-278"><a href="#cb78-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-279"><a href="#cb78-279" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-280"><a href="#cb78-280" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Show DB</span></span>
<span id="cb78-281"><a href="#cb78-281" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-282"><a href="#cb78-282" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database:"</span>)</span>
<span id="cb78-283"><a href="#cb78-283" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(db)</span>
<span id="cb78-284"><a href="#cb78-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-285"><a href="#cb78-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-286"><a href="#cb78-286" aria-hidden="true" tabindex="-1"></a>Let's make a bit more complex model. We are going to add more fields having more than one entry. So, pandas dataframe is not a good choice. We will use json data format instead.</span>
<span id="cb78-287"><a href="#cb78-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-290"><a href="#cb78-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-291"><a href="#cb78-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-292"><a href="#cb78-292" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError</span>
<span id="cb78-293"><a href="#cb78-293" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict</span>
<span id="cb78-294"><a href="#cb78-294" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb78-295"><a href="#cb78-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-296"><a href="#cb78-296" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-297"><a href="#cb78-297" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Patient model</span></span>
<span id="cb78-298"><a href="#cb78-298" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-299"><a href="#cb78-299" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb78-300"><a href="#cb78-300" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span></span>
<span id="cb78-301"><a href="#cb78-301" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb78-302"><a href="#cb78-302" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb78-303"><a href="#cb78-303" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span></span>
<span id="cb78-304"><a href="#cb78-304" aria-hidden="true" tabindex="-1"></a>    married: <span class="bu">bool</span></span>
<span id="cb78-305"><a href="#cb78-305" aria-hidden="true" tabindex="-1"></a>    allergies: List[<span class="bu">str</span>]</span>
<span id="cb78-306"><a href="#cb78-306" aria-hidden="true" tabindex="-1"></a>    contact_info: Dict[<span class="bu">str</span>, <span class="bu">str</span>]</span>
<span id="cb78-307"><a href="#cb78-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-308"><a href="#cb78-308" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-309"><a href="#cb78-309" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. In-memory "DB"</span></span>
<span id="cb78-310"><a href="#cb78-310" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-311"><a href="#cb78-311" aria-hidden="true" tabindex="-1"></a>db: List[Patient] <span class="op">=</span> []</span>
<span id="cb78-312"><a href="#cb78-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-313"><a href="#cb78-313" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-314"><a href="#cb78-314" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Insert function</span></span>
<span id="cb78-315"><a href="#cb78-315" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-316"><a href="#cb78-316" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb78-317"><a href="#cb78-317" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-318"><a href="#cb78-318" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(p.patient_id <span class="op">==</span> patient.patient_id <span class="cf">for</span> p <span class="kw">in</span> db):</span>
<span id="cb78-319"><a href="#cb78-319" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb78-320"><a href="#cb78-320" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-321"><a href="#cb78-321" aria-hidden="true" tabindex="-1"></a>    db.append(patient)</span>
<span id="cb78-322"><a href="#cb78-322" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-323"><a href="#cb78-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-324"><a href="#cb78-324" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-325"><a href="#cb78-325" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Update function</span></span>
<span id="cb78-326"><a href="#cb78-326" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-327"><a href="#cb78-327" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb78-328"><a href="#cb78-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-329"><a href="#cb78-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, p <span class="kw">in</span> <span class="bu">enumerate</span>(db):</span>
<span id="cb78-330"><a href="#cb78-330" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.patient_id <span class="op">==</span> patient.patient_id:</span>
<span id="cb78-331"><a href="#cb78-331" aria-hidden="true" tabindex="-1"></a>            db[idx] <span class="op">=</span> patient</span>
<span id="cb78-332"><a href="#cb78-332" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> with ID: </span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-333"><a href="#cb78-333" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb78-334"><a href="#cb78-334" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb78-335"><a href="#cb78-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-336"><a href="#cb78-336" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-337"><a href="#cb78-337" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Save/Load to/from JSON</span></span>
<span id="cb78-338"><a href="#cb78-338" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-339"><a href="#cb78-339" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_db_to_json(filepath<span class="op">=</span><span class="st">"patients.json"</span>):</span>
<span id="cb78-340"><a href="#cb78-340" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb78-341"><a href="#cb78-341" aria-hidden="true" tabindex="-1"></a>        json.dump([p.model_dump() <span class="cf">for</span> p <span class="kw">in</span> db], f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb78-342"><a href="#cb78-342" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Database saved to JSON."</span>)</span>
<span id="cb78-343"><a href="#cb78-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-344"><a href="#cb78-344" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_db_from_json(filepath<span class="op">=</span><span class="st">"patients.json"</span>):</span>
<span id="cb78-345"><a href="#cb78-345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-346"><a href="#cb78-346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb78-347"><a href="#cb78-347" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb78-348"><a href="#cb78-348" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> json.load(f)</span>
<span id="cb78-349"><a href="#cb78-349" aria-hidden="true" tabindex="-1"></a>            db <span class="op">=</span> [Patient(<span class="op">**</span>p) <span class="cf">for</span> p <span class="kw">in</span> data]</span>
<span id="cb78-350"><a href="#cb78-350" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Database loaded from JSON."</span>)</span>
<span id="cb78-351"><a href="#cb78-351" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb78-352"><a href="#cb78-352" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No existing database found."</span>)</span>
<span id="cb78-353"><a href="#cb78-353" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-354"><a href="#cb78-354" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Validation error while loading:"</span>, e)</span>
<span id="cb78-355"><a href="#cb78-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-356"><a href="#cb78-356" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-357"><a href="#cb78-357" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Test it</span></span>
<span id="cb78-358"><a href="#cb78-358" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-359"><a href="#cb78-359" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb78-360"><a href="#cb78-360" aria-hidden="true" tabindex="-1"></a>    load_db_from_json()</span>
<span id="cb78-361"><a href="#cb78-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-362"><a href="#cb78-362" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(</span>
<span id="cb78-363"><a href="#cb78-363" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb78-364"><a href="#cb78-364" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb78-365"><a href="#cb78-365" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">29</span>,</span>
<span id="cb78-366"><a href="#cb78-366" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">55</span>,</span>
<span id="cb78-367"><a href="#cb78-367" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb78-368"><a href="#cb78-368" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],</span>
<span id="cb78-369"><a href="#cb78-369" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+492648973'</span>, <span class="st">'email'</span>: <span class="st">'abcrashed@gmail.com'</span>}</span>
<span id="cb78-370"><a href="#cb78-370" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-371"><a href="#cb78-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-372"><a href="#cb78-372" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(</span>
<span id="cb78-373"><a href="#cb78-373" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P002'</span>,</span>
<span id="cb78-374"><a href="#cb78-374" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb78-375"><a href="#cb78-375" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb78-376"><a href="#cb78-376" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="dv">70</span>,</span>
<span id="cb78-377"><a href="#cb78-377" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb78-378"><a href="#cb78-378" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Pollen'</span>],</span>
<span id="cb78-379"><a href="#cb78-379" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49663882'</span>, <span class="st">'email'</span>: <span class="st">'rashed@gmail.com'</span>}</span>
<span id="cb78-380"><a href="#cb78-380" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-381"><a href="#cb78-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-382"><a href="#cb78-382" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-383"><a href="#cb78-383" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb78-384"><a href="#cb78-384" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)  <span class="co"># Duplicate test</span></span>
<span id="cb78-385"><a href="#cb78-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-386"><a href="#cb78-386" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update</span></span>
<span id="cb78-387"><a href="#cb78-387" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(</span>
<span id="cb78-388"><a href="#cb78-388" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb78-389"><a href="#cb78-389" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed'</span>,</span>
<span id="cb78-390"><a href="#cb78-390" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb78-391"><a href="#cb78-391" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">56.7</span>,</span>
<span id="cb78-392"><a href="#cb78-392" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb78-393"><a href="#cb78-393" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],</span>
<span id="cb78-394"><a href="#cb78-394" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+492648973'</span>, <span class="st">'email'</span>: <span class="st">'abcrashed@gmail.com'</span>}</span>
<span id="cb78-395"><a href="#cb78-395" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-396"><a href="#cb78-396" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb78-397"><a href="#cb78-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-398"><a href="#cb78-398" aria-hidden="true" tabindex="-1"></a>    save_db_to_json()</span>
<span id="cb78-399"><a href="#cb78-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-400"><a href="#cb78-400" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-401"><a href="#cb78-401" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Validation Error:"</span>, e)</span>
<span id="cb78-402"><a href="#cb78-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-403"><a href="#cb78-403" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-404"><a href="#cb78-404" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Show database</span></span>
<span id="cb78-405"><a href="#cb78-405" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-406"><a href="#cb78-406" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Current Database (in-memory):"</span>)</span>
<span id="cb78-407"><a href="#cb78-407" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb78-408"><a href="#cb78-408" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(patient.model_dump())</span>
<span id="cb78-409"><a href="#cb78-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb78-410"><a href="#cb78-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-411"><a href="#cb78-411" aria-hidden="true" tabindex="-1"></a>Why did not we use <span class="in">`list`</span> and <span class="in">`dict`</span> though? Because, we could make sure that the fields are list and string, but we could not check the data types inside those list or dict. That's why we used 2-step validation using <span class="in">`List[str]`</span> and <span class="in">`Dict[str, str]`</span>.</span>
<span id="cb78-412"><a href="#cb78-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-413"><a href="#cb78-413" aria-hidden="true" tabindex="-1"></a>We could make our model more flexible. For example, not every patient will have allergies, but that field is required now! Let's work around that.</span>
<span id="cb78-414"><a href="#cb78-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-415"><a href="#cb78-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## Making Fields Optional and Adding Validation</span></span>
<span id="cb78-416"><a href="#cb78-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-417"><a href="#cb78-417" aria-hidden="true" tabindex="-1"></a>In real-world applications, not all fields are required. Let's make our model more realistic by adding optional fields and custom validation:</span>
<span id="cb78-418"><a href="#cb78-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-421"><a href="#cb78-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-422"><a href="#cb78-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-423"><a href="#cb78-423" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, ValidationError, Field, validator</span>
<span id="cb78-424"><a href="#cb78-424" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Optional</span>
<span id="cb78-425"><a href="#cb78-425" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb78-426"><a href="#cb78-426" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb78-427"><a href="#cb78-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-428"><a href="#cb78-428" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-429"><a href="#cb78-429" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Enhanced Patient model with optional fields and validation</span></span>
<span id="cb78-430"><a href="#cb78-430" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-431"><a href="#cb78-431" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Patient(BaseModel):</span>
<span id="cb78-432"><a href="#cb78-432" aria-hidden="true" tabindex="-1"></a>    patient_id: <span class="bu">str</span> <span class="op">=</span> Field(..., min_length<span class="op">=</span><span class="dv">4</span>, max_length<span class="op">=</span><span class="dv">10</span>, description<span class="op">=</span><span class="st">"Unique patient identifier"</span>)</span>
<span id="cb78-433"><a href="#cb78-433" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span> <span class="op">=</span> Field(..., min_length<span class="op">=</span><span class="dv">2</span>, max_length<span class="op">=</span><span class="dv">50</span>, description<span class="op">=</span><span class="st">"Patient full name"</span>)</span>
<span id="cb78-434"><a href="#cb78-434" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span> <span class="op">=</span> Field(..., ge<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">150</span>, description<span class="op">=</span><span class="st">"Patient age in years"</span>)</span>
<span id="cb78-435"><a href="#cb78-435" aria-hidden="true" tabindex="-1"></a>    weight: <span class="bu">float</span> <span class="op">=</span> Field(..., gt<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">500</span>, description<span class="op">=</span><span class="st">"Patient weight in kg"</span>)</span>
<span id="cb78-436"><a href="#cb78-436" aria-hidden="true" tabindex="-1"></a>    height: Optional[<span class="bu">float</span>] <span class="op">=</span> Field(<span class="va">None</span>, gt<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">300</span>, description<span class="op">=</span><span class="st">"Patient height in cm"</span>)</span>
<span id="cb78-437"><a href="#cb78-437" aria-hidden="true" tabindex="-1"></a>    married: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>  <span class="co"># Default value</span></span>
<span id="cb78-438"><a href="#cb78-438" aria-hidden="true" tabindex="-1"></a>    allergies: Optional[List[<span class="bu">str</span>]] <span class="op">=</span> Field(default<span class="op">=</span>[], description<span class="op">=</span><span class="st">"List of known allergies"</span>)</span>
<span id="cb78-439"><a href="#cb78-439" aria-hidden="true" tabindex="-1"></a>    contact_info: Dict[<span class="bu">str</span>, <span class="bu">str</span>] <span class="op">=</span> Field(default_factory<span class="op">=</span><span class="bu">dict</span>, description<span class="op">=</span><span class="st">"Contact information"</span>)</span>
<span id="cb78-440"><a href="#cb78-440" aria-hidden="true" tabindex="-1"></a>    emergency_contact: Optional[Dict[<span class="bu">str</span>, <span class="bu">str</span>]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb78-441"><a href="#cb78-441" aria-hidden="true" tabindex="-1"></a>    blood_type: Optional[<span class="bu">str</span>] <span class="op">=</span> Field(<span class="va">None</span>, regex<span class="op">=</span><span class="vs">r'^(A|B|AB|O)[+-]</span></span>
<span id="cb78-442"><a href="#cb78-442" aria-hidden="true" tabindex="-1"></a><span class="er">, description="Blood type (e.g., A+, O-, AB+)")</span></span>
<span id="cb78-443"><a href="#cb78-443" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-444"><a href="#cb78-444" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom validator for name formatting</span></span>
<span id="cb78-445"><a href="#cb78-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">@validator</span>(<span class="st">'name'</span>)</span>
<span id="cb78-446"><a href="#cb78-446" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> name_must_not_be_empty_or_just_spaces(cls, v):</span>
<span id="cb78-447"><a href="#cb78-447" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> v.strip():</span>
<span id="cb78-448"><a href="#cb78-448" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Name cannot be empty or just spaces'</span>)</span>
<span id="cb78-449"><a href="#cb78-449" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v.strip().title()  <span class="co"># Capitalize properly</span></span>
<span id="cb78-450"><a href="#cb78-450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-451"><a href="#cb78-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom validator for phone number in contact_info</span></span>
<span id="cb78-452"><a href="#cb78-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">@validator</span>(<span class="st">'contact_info'</span>)</span>
<span id="cb78-453"><a href="#cb78-453" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> validate_contact_info(cls, v):</span>
<span id="cb78-454"><a href="#cb78-454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'phone'</span> <span class="kw">in</span> v:</span>
<span id="cb78-455"><a href="#cb78-455" aria-hidden="true" tabindex="-1"></a>            phone <span class="op">=</span> v[<span class="st">'phone'</span>]</span>
<span id="cb78-456"><a href="#cb78-456" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Simple phone validation (starts with + and has digits)</span></span>
<span id="cb78-457"><a href="#cb78-457" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> phone.startswith(<span class="st">'+'</span>) <span class="kw">or</span> <span class="kw">not</span> phone[<span class="dv">1</span>:].replace(<span class="st">'-'</span>, <span class="st">''</span>).replace(<span class="st">' '</span>, <span class="st">''</span>).isdigit():</span>
<span id="cb78-458"><a href="#cb78-458" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Phone number must start with + and contain valid digits'</span>)</span>
<span id="cb78-459"><a href="#cb78-459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> v</span>
<span id="cb78-460"><a href="#cb78-460" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-461"><a href="#cb78-461" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate BMI if height is provided</span></span>
<span id="cb78-462"><a href="#cb78-462" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calculate_bmi(<span class="va">self</span>) <span class="op">-&gt;</span> Optional[<span class="bu">float</span>]:</span>
<span id="cb78-463"><a href="#cb78-463" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.height:</span>
<span id="cb78-464"><a href="#cb78-464" aria-hidden="true" tabindex="-1"></a>            height_m <span class="op">=</span> <span class="va">self</span>.height <span class="op">/</span> <span class="dv">100</span>  <span class="co"># Convert cm to meters</span></span>
<span id="cb78-465"><a href="#cb78-465" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">round</span>(<span class="va">self</span>.weight <span class="op">/</span> (height_m <span class="op">**</span> <span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb78-466"><a href="#cb78-466" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb78-467"><a href="#cb78-467" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-468"><a href="#cb78-468" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if patient is adult</span></span>
<span id="cb78-469"><a href="#cb78-469" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_adult(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb78-470"><a href="#cb78-470" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.age <span class="op">&gt;=</span> <span class="dv">18</span></span>
<span id="cb78-471"><a href="#cb78-471" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-472"><a href="#cb78-472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get formatted patient info</span></span>
<span id="cb78-473"><a href="#cb78-473" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_summary(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb78-474"><a href="#cb78-474" aria-hidden="true" tabindex="-1"></a>        bmi <span class="op">=</span> <span class="va">self</span>.calculate_bmi()</span>
<span id="cb78-475"><a href="#cb78-475" aria-hidden="true" tabindex="-1"></a>        bmi_str <span class="op">=</span> <span class="ss">f", BMI: </span><span class="sc">{</span>bmi<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> bmi <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb78-476"><a href="#cb78-476" aria-hidden="true" tabindex="-1"></a>        allergies_str <span class="op">=</span> <span class="ss">f", Allergies: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(<span class="va">self</span>.allergies)<span class="sc">}</span><span class="ss">"</span> <span class="cf">if</span> <span class="va">self</span>.allergies <span class="cf">else</span> <span class="st">", No known allergies"</span></span>
<span id="cb78-477"><a href="#cb78-477" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (ID: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">), Age: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>age<span class="sc">}</span><span class="ss">, Weight: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>weight<span class="sc">}</span><span class="ss">kg</span><span class="sc">{</span>bmi_str<span class="sc">}{</span>allergies_str<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb78-478"><a href="#cb78-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-479"><a href="#cb78-479" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-480"><a href="#cb78-480" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Enhanced database operations</span></span>
<span id="cb78-481"><a href="#cb78-481" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-482"><a href="#cb78-482" aria-hidden="true" tabindex="-1"></a>db: List[Patient] <span class="op">=</span> []</span>
<span id="cb78-483"><a href="#cb78-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-484"><a href="#cb78-484" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_patient_data(patient: Patient):</span>
<span id="cb78-485"><a href="#cb78-485" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-486"><a href="#cb78-486" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">any</span>(p.patient_id <span class="op">==</span> patient.patient_id <span class="cf">for</span> p <span class="kw">in</span> db):</span>
<span id="cb78-487"><a href="#cb78-487" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' already exists. Use update instead."</span>)</span>
<span id="cb78-488"><a href="#cb78-488" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb78-489"><a href="#cb78-489" aria-hidden="true" tabindex="-1"></a>    db.append(patient)</span>
<span id="cb78-490"><a href="#cb78-490" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✅ Inserted patient: </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-491"><a href="#cb78-491" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb78-492"><a href="#cb78-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-493"><a href="#cb78-493" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_patient_data(patient: Patient):</span>
<span id="cb78-494"><a href="#cb78-494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-495"><a href="#cb78-495" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, p <span class="kw">in</span> <span class="bu">enumerate</span>(db):</span>
<span id="cb78-496"><a href="#cb78-496" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p.patient_id <span class="op">==</span> patient.patient_id:</span>
<span id="cb78-497"><a href="#cb78-497" aria-hidden="true" tabindex="-1"></a>            db[idx] <span class="op">=</span> patient</span>
<span id="cb78-498"><a href="#cb78-498" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"✅ Updated patient: </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-499"><a href="#cb78-499" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb78-500"><a href="#cb78-500" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Patient ID '</span><span class="sc">{</span>patient<span class="sc">.</span>patient_id<span class="sc">}</span><span class="ss">' not found. Use insert instead."</span>)</span>
<span id="cb78-501"><a href="#cb78-501" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb78-502"><a href="#cb78-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-503"><a href="#cb78-503" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_patient_by_id(patient_id: <span class="bu">str</span>) <span class="op">-&gt;</span> Optional[Patient]:</span>
<span id="cb78-504"><a href="#cb78-504" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb78-505"><a href="#cb78-505" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.patient_id <span class="op">==</span> patient_id:</span>
<span id="cb78-506"><a href="#cb78-506" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> patient</span>
<span id="cb78-507"><a href="#cb78-507" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb78-508"><a href="#cb78-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-509"><a href="#cb78-509" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> list_all_patients():</span>
<span id="cb78-510"><a href="#cb78-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> db:</span>
<span id="cb78-511"><a href="#cb78-511" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"📭 No patients in database."</span>)</span>
<span id="cb78-512"><a href="#cb78-512" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb78-513"><a href="#cb78-513" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-514"><a href="#cb78-514" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">👥 All Patients (</span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> total):"</span>)</span>
<span id="cb78-515"><a href="#cb78-515" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb78-516"><a href="#cb78-516" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> db:</span>
<span id="cb78-517"><a href="#cb78-517" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"🏥 </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-518"><a href="#cb78-518" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.blood_type:</span>
<span id="cb78-519"><a href="#cb78-519" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   🩸 Blood Type: </span><span class="sc">{</span>patient<span class="sc">.</span>blood_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-520"><a href="#cb78-520" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> patient.contact_info:</span>
<span id="cb78-521"><a href="#cb78-521" aria-hidden="true" tabindex="-1"></a>            contact_str <span class="op">=</span> <span class="st">", "</span>.join([<span class="ss">f"</span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>v<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k, v <span class="kw">in</span> patient.contact_info.items()])</span>
<span id="cb78-522"><a href="#cb78-522" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   📞 Contact: </span><span class="sc">{</span>contact_str<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-523"><a href="#cb78-523" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb78-524"><a href="#cb78-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-525"><a href="#cb78-525" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_patients_by_age_range(min_age: <span class="bu">int</span>, max_age: <span class="bu">int</span>) <span class="op">-&gt;</span> List[Patient]:</span>
<span id="cb78-526"><a href="#cb78-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> min_age <span class="op">&lt;=</span> p.age <span class="op">&lt;=</span> max_age]</span>
<span id="cb78-527"><a href="#cb78-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-528"><a href="#cb78-528" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_patients_with_allergies() <span class="op">-&gt;</span> List[Patient]:</span>
<span id="cb78-529"><a href="#cb78-529" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> p.allergies]</span>
<span id="cb78-530"><a href="#cb78-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-531"><a href="#cb78-531" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-532"><a href="#cb78-532" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Test the enhanced system</span></span>
<span id="cb78-533"><a href="#cb78-533" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------</span></span>
<span id="cb78-534"><a href="#cb78-534" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"🏥 Testing Enhanced Patient Management System"</span>)</span>
<span id="cb78-535"><a href="#cb78-535" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb78-536"><a href="#cb78-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-537"><a href="#cb78-537" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb78-538"><a href="#cb78-538" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 1: Valid patient with all fields</span></span>
<span id="cb78-539"><a href="#cb78-539" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 1: Complete patient record"</span>)</span>
<span id="cb78-540"><a href="#cb78-540" aria-hidden="true" tabindex="-1"></a>    patient1 <span class="op">=</span> Patient(</span>
<span id="cb78-541"><a href="#cb78-541" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb78-542"><a href="#cb78-542" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'   rashed uzzaman   '</span>,  <span class="co"># Will be cleaned and capitalized</span></span>
<span id="cb78-543"><a href="#cb78-543" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">29</span>,</span>
<span id="cb78-544"><a href="#cb78-544" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">65.5</span>,</span>
<span id="cb78-545"><a href="#cb78-545" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">175</span>,</span>
<span id="cb78-546"><a href="#cb78-546" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb78-547"><a href="#cb78-547" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>, <span class="st">'Cats'</span>],</span>
<span id="cb78-548"><a href="#cb78-548" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-123-456789'</span>, <span class="st">'email'</span>: <span class="st">'rashed@email.com'</span>},</span>
<span id="cb78-549"><a href="#cb78-549" aria-hidden="true" tabindex="-1"></a>        emergency_contact<span class="op">=</span>{<span class="st">'name'</span>: <span class="st">'Jane Doe'</span>, <span class="st">'phone'</span>: <span class="st">'+49-987-654321'</span>},</span>
<span id="cb78-550"><a href="#cb78-550" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'O+'</span></span>
<span id="cb78-551"><a href="#cb78-551" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-552"><a href="#cb78-552" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-553"><a href="#cb78-553" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   BMI: </span><span class="sc">{</span>patient1<span class="sc">.</span>calculate_bmi()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-554"><a href="#cb78-554" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Adult: </span><span class="sc">{</span>patient1<span class="sc">.</span>is_adult()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-555"><a href="#cb78-555" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-556"><a href="#cb78-556" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 2: Minimal patient record (using defaults)</span></span>
<span id="cb78-557"><a href="#cb78-557" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 2: Minimal patient record"</span>)</span>
<span id="cb78-558"><a href="#cb78-558" aria-hidden="true" tabindex="-1"></a>    patient2 <span class="op">=</span> Patient(</span>
<span id="cb78-559"><a href="#cb78-559" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P002'</span>,</span>
<span id="cb78-560"><a href="#cb78-560" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Alice Johnson'</span>,</span>
<span id="cb78-561"><a href="#cb78-561" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">35</span>,</span>
<span id="cb78-562"><a href="#cb78-562" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">58.2</span></span>
<span id="cb78-563"><a href="#cb78-563" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-564"><a href="#cb78-564" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient2)</span>
<span id="cb78-565"><a href="#cb78-565" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-566"><a href="#cb78-566" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 3: Child patient</span></span>
<span id="cb78-567"><a href="#cb78-567" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 3: Child patient"</span>)</span>
<span id="cb78-568"><a href="#cb78-568" aria-hidden="true" tabindex="-1"></a>    patient3 <span class="op">=</span> Patient(</span>
<span id="cb78-569"><a href="#cb78-569" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P003'</span>,</span>
<span id="cb78-570"><a href="#cb78-570" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Bobby Smith'</span>,</span>
<span id="cb78-571"><a href="#cb78-571" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb78-572"><a href="#cb78-572" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">40.0</span>,</span>
<span id="cb78-573"><a href="#cb78-573" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">150</span>,</span>
<span id="cb78-574"><a href="#cb78-574" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Peanuts'</span>],</span>
<span id="cb78-575"><a href="#cb78-575" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-555-123456'</span>},</span>
<span id="cb78-576"><a href="#cb78-576" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'A-'</span></span>
<span id="cb78-577"><a href="#cb78-577" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-578"><a href="#cb78-578" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient3)</span>
<span id="cb78-579"><a href="#cb78-579" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   Adult: </span><span class="sc">{</span>patient3<span class="sc">.</span>is_adult()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-580"><a href="#cb78-580" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-581"><a href="#cb78-581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 4: Try to insert duplicate</span></span>
<span id="cb78-582"><a href="#cb78-582" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 4: Duplicate insertion attempt"</span>)</span>
<span id="cb78-583"><a href="#cb78-583" aria-hidden="true" tabindex="-1"></a>    insert_patient_data(patient1)</span>
<span id="cb78-584"><a href="#cb78-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-585"><a href="#cb78-585" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test 5: Update patient</span></span>
<span id="cb78-586"><a href="#cb78-586" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🧪 Test 5: Update patient weight"</span>)</span>
<span id="cb78-587"><a href="#cb78-587" aria-hidden="true" tabindex="-1"></a>    patient1_updated <span class="op">=</span> Patient(</span>
<span id="cb78-588"><a href="#cb78-588" aria-hidden="true" tabindex="-1"></a>        patient_id<span class="op">=</span><span class="st">'P001'</span>,</span>
<span id="cb78-589"><a href="#cb78-589" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">'Rashed Uzzaman'</span>,</span>
<span id="cb78-590"><a href="#cb78-590" aria-hidden="true" tabindex="-1"></a>        age<span class="op">=</span><span class="dv">30</span>,  <span class="co"># Birthday!</span></span>
<span id="cb78-591"><a href="#cb78-591" aria-hidden="true" tabindex="-1"></a>        weight<span class="op">=</span><span class="fl">67.0</span>,  <span class="co"># Gained weight</span></span>
<span id="cb78-592"><a href="#cb78-592" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span><span class="dv">175</span>,</span>
<span id="cb78-593"><a href="#cb78-593" aria-hidden="true" tabindex="-1"></a>        married<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb78-594"><a href="#cb78-594" aria-hidden="true" tabindex="-1"></a>        allergies<span class="op">=</span>[<span class="st">'Dust'</span>, <span class="st">'Pollen'</span>],  <span class="co"># No longer allergic to cats!</span></span>
<span id="cb78-595"><a href="#cb78-595" aria-hidden="true" tabindex="-1"></a>        contact_info<span class="op">=</span>{<span class="st">'phone'</span>: <span class="st">'+49-123-456789'</span>, <span class="st">'email'</span>: <span class="st">'rashed.new@email.com'</span>},</span>
<span id="cb78-596"><a href="#cb78-596" aria-hidden="true" tabindex="-1"></a>        blood_type<span class="op">=</span><span class="st">'O+'</span></span>
<span id="cb78-597"><a href="#cb78-597" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-598"><a href="#cb78-598" aria-hidden="true" tabindex="-1"></a>    update_patient_data(patient1_updated)</span>
<span id="cb78-599"><a href="#cb78-599" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-600"><a href="#cb78-600" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-601"><a href="#cb78-601" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Validation Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-602"><a href="#cb78-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-603"><a href="#cb78-603" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all patients</span></span>
<span id="cb78-604"><a href="#cb78-604" aria-hidden="true" tabindex="-1"></a>list_all_patients()</span>
<span id="cb78-605"><a href="#cb78-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-606"><a href="#cb78-606" aria-hidden="true" tabindex="-1"></a><span class="co"># Query examples</span></span>
<span id="cb78-607"><a href="#cb78-607" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🔍 Query Examples:"</span>)</span>
<span id="cb78-608"><a href="#cb78-608" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb78-609"><a href="#cb78-609" aria-hidden="true" tabindex="-1"></a>adults <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> db <span class="cf">if</span> p.is_adult()]</span>
<span id="cb78-610"><a href="#cb78-610" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"👨‍👩‍👧‍👦 Adult patients: </span><span class="sc">{</span><span class="bu">len</span>(adults)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-611"><a href="#cb78-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-612"><a href="#cb78-612" aria-hidden="true" tabindex="-1"></a>patients_with_allergies <span class="op">=</span> get_patients_with_allergies()</span>
<span id="cb78-613"><a href="#cb78-613" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🤧 Patients with allergies: </span><span class="sc">{</span><span class="bu">len</span>(patients_with_allergies)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-614"><a href="#cb78-614" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> patients_with_allergies:</span>
<span id="cb78-615"><a href="#cb78-615" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - </span><span class="sc">{</span>p<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(p.allergies)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-616"><a href="#cb78-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-617"><a href="#cb78-617" aria-hidden="true" tabindex="-1"></a>young_adults <span class="op">=</span> get_patients_by_age_range(<span class="dv">18</span>, <span class="dv">30</span>)</span>
<span id="cb78-618"><a href="#cb78-618" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🧑 Young adults (18-30): </span><span class="sc">{</span><span class="bu">len</span>(young_adults)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-619"><a href="#cb78-619" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> young_adults:</span>
<span id="cb78-620"><a href="#cb78-620" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"   - </span><span class="sc">{</span>p<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>p<span class="sc">.</span>age<span class="sc">}</span><span class="ss"> years old)"</span>)</span>
<span id="cb78-621"><a href="#cb78-621" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb78-622"><a href="#cb78-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-623"><a href="#cb78-623" aria-hidden="true" tabindex="-1"></a><span class="co">## Advanced Validation with Custom Validators</span></span>
<span id="cb78-624"><a href="#cb78-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-625"><a href="#cb78-625" aria-hidden="true" tabindex="-1"></a>Now let<span class="st">'s see what happens when we try to insert invalid data. Pydantic will catch these errors and give us helpful messages:</span></span>
<span id="cb78-626"><a href="#cb78-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-629"><a href="#cb78-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-630"><a href="#cb78-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-631"><a href="#cb78-631" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">🚨 Testing Validation Errors"</span>)</span>
<span id="cb78-632"><a href="#cb78-632" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb78-633"><a href="#cb78-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-634"><a href="#cb78-634" aria-hidden="true" tabindex="-1"></a><span class="co"># Test invalid data scenarios</span></span>
<span id="cb78-635"><a href="#cb78-635" aria-hidden="true" tabindex="-1"></a>test_cases <span class="op">=</span> [</span>
<span id="cb78-636"><a href="#cb78-636" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-637"><a href="#cb78-637" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Age Test'</span>,</span>
<span id="cb78-638"><a href="#cb78-638" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P999'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="op">-</span><span class="dv">5</span>, <span class="st">'weight'</span>: <span class="dv">70</span>},</span>
<span id="cb78-639"><a href="#cb78-639" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Age cannot be negative'</span></span>
<span id="cb78-640"><a href="#cb78-640" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb78-641"><a href="#cb78-641" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-642"><a href="#cb78-642" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Weight Test'</span>, </span>
<span id="cb78-643"><a href="#cb78-643" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P998'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">0</span>},</span>
<span id="cb78-644"><a href="#cb78-644" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Weight must be greater than 0'</span></span>
<span id="cb78-645"><a href="#cb78-645" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb78-646"><a href="#cb78-646" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-647"><a href="#cb78-647" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Blood Type Test'</span>,</span>
<span id="cb78-648"><a href="#cb78-648" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P997'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>, <span class="st">'blood_type'</span>: <span class="st">'XYZ'</span>},</span>
<span id="cb78-649"><a href="#cb78-649" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Invalid blood type format'</span></span>
<span id="cb78-650"><a href="#cb78-650" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb78-651"><a href="#cb78-651" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-652"><a href="#cb78-652" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Invalid Phone Number Test'</span>,</span>
<span id="cb78-653"><a href="#cb78-653" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P996'</span>, <span class="st">'name'</span>: <span class="st">'Test Patient'</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>, <span class="st">'contact_info'</span>: {<span class="st">'phone'</span>: <span class="st">'invalid-phone'</span>}},</span>
<span id="cb78-654"><a href="#cb78-654" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Invalid phone number format'</span></span>
<span id="cb78-655"><a href="#cb78-655" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb78-656"><a href="#cb78-656" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb78-657"><a href="#cb78-657" aria-hidden="true" tabindex="-1"></a>        <span class="st">'name'</span>: <span class="st">'Empty Name Test'</span>,</span>
<span id="cb78-658"><a href="#cb78-658" aria-hidden="true" tabindex="-1"></a>        <span class="st">'data'</span>: {<span class="st">'patient_id'</span>: <span class="st">'P995'</span>, <span class="st">'name'</span>: <span class="st">'   '</span>, <span class="st">'age'</span>: <span class="dv">25</span>, <span class="st">'weight'</span>: <span class="dv">70</span>},</span>
<span id="cb78-659"><a href="#cb78-659" aria-hidden="true" tabindex="-1"></a>        <span class="st">'expected_error'</span>: <span class="st">'Name cannot be empty'</span></span>
<span id="cb78-660"><a href="#cb78-660" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb78-661"><a href="#cb78-661" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb78-662"><a href="#cb78-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-663"><a href="#cb78-663" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> test <span class="kw">in</span> test_cases:</span>
<span id="cb78-664"><a href="#cb78-664" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🧪 </span><span class="sc">{</span>test[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb78-665"><a href="#cb78-665" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb78-666"><a href="#cb78-666" aria-hidden="true" tabindex="-1"></a>        invalid_patient <span class="op">=</span> Patient(<span class="op">**</span>test[<span class="st">'data'</span>])</span>
<span id="cb78-667"><a href="#cb78-667" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ⚠️ Unexpectedly succeeded: </span><span class="sc">{</span>invalid_patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-668"><a href="#cb78-668" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-669"><a href="#cb78-669" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ✅ Correctly caught error: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">.</span>split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-670"><a href="#cb78-670" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb78-671"><a href="#cb78-671" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ❌ Unexpected error type: </span><span class="sc">{</span><span class="bu">type</span>(e)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-672"><a href="#cb78-672" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb78-673"><a href="#cb78-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-674"><a href="#cb78-674" aria-hidden="true" tabindex="-1"></a><span class="co">## Real-World Data Processing with Pydantic</span></span>
<span id="cb78-675"><a href="#cb78-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-676"><a href="#cb78-676" aria-hidden="true" tabindex="-1"></a>Let<span class="st">'s simulate reading patient data from a CSV file and using Pydantic to validate and clean it:</span></span>
<span id="cb78-677"><a href="#cb78-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-680"><a href="#cb78-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-681"><a href="#cb78-681" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-682"><a href="#cb78-682" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb78-683"><a href="#cb78-683" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb78-684"><a href="#cb78-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-685"><a href="#cb78-685" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate CSV data (in real world, you'd read from a file)</span></span>
<span id="cb78-686"><a href="#cb78-686" aria-hidden="true" tabindex="-1"></a>csv_data <span class="op">=</span> <span class="st">"""patient_id,name,age,weight,height,married,allergies,phone,email,blood_type</span></span>
<span id="cb78-687"><a href="#cb78-687" aria-hidden="true" tabindex="-1"></a><span class="st">P101,john doe,25,70.5,180,true,"Dust,Pollen",+49-111-222333,john@email.com,A+</span></span>
<span id="cb78-688"><a href="#cb78-688" aria-hidden="true" tabindex="-1"></a><span class="st">P102,JANE SMITH,35,65.0,,false,Peanuts,+49-444-555666,jane@email.com,O-</span></span>
<span id="cb78-689"><a href="#cb78-689" aria-hidden="true" tabindex="-1"></a><span class="st">P103,bob wilson,17,55.2,165,false,,+49-777-888999,bob@email.com,</span></span>
<span id="cb78-690"><a href="#cb78-690" aria-hidden="true" tabindex="-1"></a><span class="st">P104,invalid patient,-5,0,200,maybe,Bad Data,invalid-phone,not-an-email,XYZ</span></span>
<span id="cb78-691"><a href="#cb78-691" aria-hidden="true" tabindex="-1"></a><span class="st">P105,mary johnson,45,72.3,168,true,"Shellfish,Latex",+49-123-987654,mary@email.com,B+</span></span>
<span id="cb78-692"><a href="#cb78-692" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb78-693"><a href="#cb78-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-694"><a href="#cb78-694" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_csv_data(csv_content: <span class="bu">str</span>):</span>
<span id="cb78-695"><a href="#cb78-695" aria-hidden="true" tabindex="-1"></a>    <span class="st">"""Process CSV data and create Patient objects with validation"""</span></span>
<span id="cb78-696"><a href="#cb78-696" aria-hidden="true" tabindex="-1"></a>    successful_patients <span class="op">=</span> []</span>
<span id="cb78-697"><a href="#cb78-697" aria-hidden="true" tabindex="-1"></a>    failed_records <span class="op">=</span> []</span>
<span id="cb78-698"><a href="#cb78-698" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-699"><a href="#cb78-699" aria-hidden="true" tabindex="-1"></a>    csv_reader <span class="op">=</span> csv.DictReader(StringIO(csv_content))</span>
<span id="cb78-700"><a href="#cb78-700" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-701"><a href="#cb78-701" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row_num, row <span class="kw">in</span> <span class="bu">enumerate</span>(csv_reader, <span class="dv">1</span>):</span>
<span id="cb78-702"><a href="#cb78-702" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb78-703"><a href="#cb78-703" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clean and prepare data</span></span>
<span id="cb78-704"><a href="#cb78-704" aria-hidden="true" tabindex="-1"></a>            processed_row <span class="op">=</span> {</span>
<span id="cb78-705"><a href="#cb78-705" aria-hidden="true" tabindex="-1"></a>                <span class="st">'patient_id'</span>: row[<span class="st">'patient_id'</span>].strip(),</span>
<span id="cb78-706"><a href="#cb78-706" aria-hidden="true" tabindex="-1"></a>                <span class="st">'name'</span>: row[<span class="st">'name'</span>].strip(),</span>
<span id="cb78-707"><a href="#cb78-707" aria-hidden="true" tabindex="-1"></a>                <span class="st">'age'</span>: <span class="bu">int</span>(row[<span class="st">'age'</span>]),</span>
<span id="cb78-708"><a href="#cb78-708" aria-hidden="true" tabindex="-1"></a>                <span class="st">'weight'</span>: <span class="bu">float</span>(row[<span class="st">'weight'</span>]),</span>
<span id="cb78-709"><a href="#cb78-709" aria-hidden="true" tabindex="-1"></a>                <span class="st">'married'</span>: row[<span class="st">'married'</span>].lower() <span class="kw">in</span> [<span class="st">'true'</span>, <span class="st">'1'</span>, <span class="st">'yes'</span>],</span>
<span id="cb78-710"><a href="#cb78-710" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb78-711"><a href="#cb78-711" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-712"><a href="#cb78-712" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Handle optional fields</span></span>
<span id="cb78-713"><a href="#cb78-713" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'height'</span>].strip():</span>
<span id="cb78-714"><a href="#cb78-714" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'height'</span>] <span class="op">=</span> <span class="bu">float</span>(row[<span class="st">'height'</span>])</span>
<span id="cb78-715"><a href="#cb78-715" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-716"><a href="#cb78-716" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Process allergies (split by comma if present)</span></span>
<span id="cb78-717"><a href="#cb78-717" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'allergies'</span>].strip():</span>
<span id="cb78-718"><a href="#cb78-718" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'allergies'</span>] <span class="op">=</span> [a.strip() <span class="cf">for</span> a <span class="kw">in</span> row[<span class="st">'allergies'</span>].split(<span class="st">','</span>)]</span>
<span id="cb78-719"><a href="#cb78-719" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-720"><a href="#cb78-720" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Build contact info</span></span>
<span id="cb78-721"><a href="#cb78-721" aria-hidden="true" tabindex="-1"></a>            contact_info <span class="op">=</span> {}</span>
<span id="cb78-722"><a href="#cb78-722" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'phone'</span>].strip():</span>
<span id="cb78-723"><a href="#cb78-723" aria-hidden="true" tabindex="-1"></a>                contact_info[<span class="st">'phone'</span>] <span class="op">=</span> row[<span class="st">'phone'</span>].strip()</span>
<span id="cb78-724"><a href="#cb78-724" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'email'</span>].strip():</span>
<span id="cb78-725"><a href="#cb78-725" aria-hidden="true" tabindex="-1"></a>                contact_info[<span class="st">'email'</span>] <span class="op">=</span> row[<span class="st">'email'</span>].strip()</span>
<span id="cb78-726"><a href="#cb78-726" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contact_info:</span>
<span id="cb78-727"><a href="#cb78-727" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'contact_info'</span>] <span class="op">=</span> contact_info</span>
<span id="cb78-728"><a href="#cb78-728" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-729"><a href="#cb78-729" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Blood type</span></span>
<span id="cb78-730"><a href="#cb78-730" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="st">'blood_type'</span>].strip():</span>
<span id="cb78-731"><a href="#cb78-731" aria-hidden="true" tabindex="-1"></a>                processed_row[<span class="st">'blood_type'</span>] <span class="op">=</span> row[<span class="st">'blood_type'</span>].strip()</span>
<span id="cb78-732"><a href="#cb78-732" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-733"><a href="#cb78-733" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create Patient object (this will validate everything)</span></span>
<span id="cb78-734"><a href="#cb78-734" aria-hidden="true" tabindex="-1"></a>            patient <span class="op">=</span> Patient(<span class="op">**</span>processed_row)</span>
<span id="cb78-735"><a href="#cb78-735" aria-hidden="true" tabindex="-1"></a>            successful_patients.append(patient)</span>
<span id="cb78-736"><a href="#cb78-736" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"✅ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Successfully processed </span><span class="sc">{</span>patient<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-737"><a href="#cb78-737" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb78-738"><a href="#cb78-738" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-739"><a href="#cb78-739" aria-hidden="true" tabindex="-1"></a>            error_msg <span class="op">=</span> <span class="bu">str</span>(e).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>)[<span class="dv">0</span>]  <span class="co"># Get first error line</span></span>
<span id="cb78-740"><a href="#cb78-740" aria-hidden="true" tabindex="-1"></a>            failed_records.append({<span class="st">'row'</span>: row_num, <span class="st">'data'</span>: row, <span class="st">'error'</span>: error_msg})</span>
<span id="cb78-741"><a href="#cb78-741" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"❌ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Validation failed - </span><span class="sc">{</span>error_msg<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-742"><a href="#cb78-742" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb78-743"><a href="#cb78-743" aria-hidden="true" tabindex="-1"></a>            failed_records.append({<span class="st">'row'</span>: row_num, <span class="st">'data'</span>: row, <span class="st">'error'</span>: <span class="bu">str</span>(e)})</span>
<span id="cb78-744"><a href="#cb78-744" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"❌ Row </span><span class="sc">{</span>row_num<span class="sc">}</span><span class="ss">: Processing failed - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-745"><a href="#cb78-745" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-746"><a href="#cb78-746" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> successful_patients, failed_records</span>
<span id="cb78-747"><a href="#cb78-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-748"><a href="#cb78-748" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">📊 Processing CSV Data with Pydantic Validation"</span>)</span>
<span id="cb78-749"><a href="#cb78-749" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb78-750"><a href="#cb78-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-751"><a href="#cb78-751" aria-hidden="true" tabindex="-1"></a>successful, failed <span class="op">=</span> process_csv_data(csv_data)</span>
<span id="cb78-752"><a href="#cb78-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-753"><a href="#cb78-753" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">📈 Summary:"</span>)</span>
<span id="cb78-754"><a href="#cb78-754" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✅ Successfully processed: </span><span class="sc">{</span><span class="bu">len</span>(successful)<span class="sc">}</span><span class="ss"> patients"</span>)</span>
<span id="cb78-755"><a href="#cb78-755" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"❌ Failed to process: </span><span class="sc">{</span><span class="bu">len</span>(failed)<span class="sc">}</span><span class="ss"> records"</span>)</span>
<span id="cb78-756"><a href="#cb78-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-757"><a href="#cb78-757" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> successful:</span>
<span id="cb78-758"><a href="#cb78-758" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">👥 Successfully Imported Patients:"</span>)</span>
<span id="cb78-759"><a href="#cb78-759" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> patient <span class="kw">in</span> successful:</span>
<span id="cb78-760"><a href="#cb78-760" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   🏥 </span><span class="sc">{</span>patient<span class="sc">.</span>get_summary()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-761"><a href="#cb78-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-762"><a href="#cb78-762" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> failed:</span>
<span id="cb78-763"><a href="#cb78-763" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">⚠️ Failed Records (need manual review):"</span>)</span>
<span id="cb78-764"><a href="#cb78-764" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> failure <span class="kw">in</span> failed:</span>
<span id="cb78-765"><a href="#cb78-765" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   Row </span><span class="sc">{</span>failure[<span class="st">'row'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>failure[<span class="st">'data'</span>][<span class="st">'name'</span>]<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>failure[<span class="st">'error'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-766"><a href="#cb78-766" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb78-767"><a href="#cb78-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-768"><a href="#cb78-768" aria-hidden="true" tabindex="-1"></a><span class="co">## Saving and Loading with JSON Schema</span></span>
<span id="cb78-769"><a href="#cb78-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-770"><a href="#cb78-770" aria-hidden="true" tabindex="-1"></a>Pydantic can also generate JSON schemas <span class="kw">and</span> work seamlessly <span class="cf">with</span> JSON data:</span>
<span id="cb78-771"><a href="#cb78-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-774"><a href="#cb78-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb78-775"><a href="#cb78-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: true</span></span>
<span id="cb78-776"><a href="#cb78-776" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb78-777"><a href="#cb78-777" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb78-778"><a href="#cb78-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-779"><a href="#cb78-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate JSON schema for our Patient model</span></span>
<span id="cb78-780"><a href="#cb78-780" aria-hidden="true" tabindex="-1"></a>patient_schema <span class="op">=</span> Patient.model_json_schema()</span>
<span id="cb78-781"><a href="#cb78-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-782"><a href="#cb78-782" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"📋 Patient Model JSON Schema:"</span>)</span>
<span id="cb78-783"><a href="#cb78-783" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">35</span>)</span>
<span id="cb78-784"><a href="#cb78-784" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(patient_schema, indent<span class="op">=</span><span class="dv">2</span>)[:<span class="dv">500</span>] <span class="op">+</span> <span class="st">"...</span><span class="ch">\n</span><span class="st">(truncated)"</span>)</span>
<span id="cb78-785"><a href="#cb78-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-786"><a href="#cb78-786" aria-hidden="true" tabindex="-1"></a><span class="co"># Save all our patients to JSON with timestamp</span></span>
<span id="cb78-787"><a href="#cb78-787" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_patients_with_metadata(filename: <span class="bu">str</span> <span class="op">=</span> <span class="st">"patients_database.json"</span>):</span>
<span id="cb78-788"><a href="#cb78-788" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb78-789"><a href="#cb78-789" aria-hidden="true" tabindex="-1"></a>        <span class="st">'timestamp'</span>: datetime.now().isoformat(),</span>
<span id="cb78-790"><a href="#cb78-790" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_patients'</span>: <span class="bu">len</span>(db),</span>
<span id="cb78-791"><a href="#cb78-791" aria-hidden="true" tabindex="-1"></a>        <span class="st">'schema_version'</span>: <span class="st">'1.0'</span>,</span>
<span id="cb78-792"><a href="#cb78-792" aria-hidden="true" tabindex="-1"></a>        <span class="st">'patients'</span>: [patient.model_dump() <span class="cf">for</span> patient <span class="kw">in</span> db]</span>
<span id="cb78-793"><a href="#cb78-793" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb78-794"><a href="#cb78-794" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-795"><a href="#cb78-795" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb78-796"><a href="#cb78-796" aria-hidden="true" tabindex="-1"></a>        json.dump(data, f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb78-797"><a href="#cb78-797" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb78-798"><a href="#cb78-798" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"💾 Saved </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients to </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-799"><a href="#cb78-799" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filename</span>
<span id="cb78-800"><a href="#cb78-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-801"><a href="#cb78-801" aria-hidden="true" tabindex="-1"></a><span class="co"># Load patients from JSON with validation</span></span>
<span id="cb78-802"><a href="#cb78-802" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_patients_with_validation(filename: <span class="bu">str</span> <span class="op">=</span> <span class="st">"patients_database.json"</span>):</span>
<span id="cb78-803"><a href="#cb78-803" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> db</span>
<span id="cb78-804"><a href="#cb78-804" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb78-805"><a href="#cb78-805" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb78-806"><a href="#cb78-806" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> json.load(f)</span>
<span id="cb78-807"><a href="#cb78-807" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-808"><a href="#cb78-808" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"📖 Loading database from </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-809"><a href="#cb78-809" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   📅 Saved on: </span><span class="sc">{</span>data[<span class="st">'timestamp'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-810"><a href="#cb78-810" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   👥 Expected patients: </span><span class="sc">{</span>data[<span class="st">'total_patients'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-811"><a href="#cb78-811" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-812"><a href="#cb78-812" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Validate and load each patient</span></span>
<span id="cb78-813"><a href="#cb78-813" aria-hidden="true" tabindex="-1"></a>        loaded_patients <span class="op">=</span> []</span>
<span id="cb78-814"><a href="#cb78-814" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> patient_data <span class="kw">in</span> data[<span class="st">'patients'</span>]:</span>
<span id="cb78-815"><a href="#cb78-815" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb78-816"><a href="#cb78-816" aria-hidden="true" tabindex="-1"></a>                patient <span class="op">=</span> Patient(<span class="op">**</span>patient_data)</span>
<span id="cb78-817"><a href="#cb78-817" aria-hidden="true" tabindex="-1"></a>                loaded_patients.append(patient)</span>
<span id="cb78-818"><a href="#cb78-818" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> ValidationError <span class="im">as</span> e:</span>
<span id="cb78-819"><a href="#cb78-819" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"   ❌ Failed to load patient </span><span class="sc">{</span>patient_data<span class="sc">.</span>get(<span class="st">'name'</span>, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-820"><a href="#cb78-820" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-821"><a href="#cb78-821" aria-hidden="true" tabindex="-1"></a>        db <span class="op">=</span> loaded_patients</span>
<span id="cb78-822"><a href="#cb78-822" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"   ✅ Successfully loaded </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients"</span>)</span>
<span id="cb78-823"><a href="#cb78-823" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb78-824"><a href="#cb78-824" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb78-825"><a href="#cb78-825" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ File </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> not found"</span>)</span>
<span id="cb78-826"><a href="#cb78-826" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> json.JSONDecodeError <span class="im">as</span> e:</span>
<span id="cb78-827"><a href="#cb78-827" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Invalid JSON in </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-828"><a href="#cb78-828" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb78-829"><a href="#cb78-829" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"❌ Error loading database: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-830"><a href="#cb78-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-831"><a href="#cb78-831" aria-hidden="true" tabindex="-1"></a><span class="co"># Save current database</span></span>
<span id="cb78-832"><a href="#cb78-832" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> save_patients_with_metadata()</span>
<span id="cb78-833"><a href="#cb78-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-834"><a href="#cb78-834" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear database and reload to test</span></span>
<span id="cb78-835"><a href="#cb78-835" aria-hidden="true" tabindex="-1"></a>original_db <span class="op">=</span> db.copy()</span>
<span id="cb78-836"><a href="#cb78-836" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> []</span>
<span id="cb78-837"><a href="#cb78-837" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🗑️ Cleared database (now has </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients)"</span>)</span>
<span id="cb78-838"><a href="#cb78-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-839"><a href="#cb78-839" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload</span></span>
<span id="cb78-840"><a href="#cb78-840" aria-hidden="true" tabindex="-1"></a>load_patients_with_validation(filename)</span>
<span id="cb78-841"><a href="#cb78-841" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"🔄 Reloaded database (now has </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss"> patients)"</span>)</span>
<span id="cb78-842"><a href="#cb78-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-843"><a href="#cb78-843" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify data integrity</span></span>
<span id="cb78-844"><a href="#cb78-844" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">🔍 Data Integrity Check:"</span>)</span>
<span id="cb78-845"><a href="#cb78-845" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(original_db) <span class="op">==</span> <span class="bu">len</span>(db):</span>
<span id="cb78-846"><a href="#cb78-846" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✅ Patient count matches"</span>)</span>
<span id="cb78-847"><a href="#cb78-847" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> orig, loaded <span class="kw">in</span> <span class="bu">zip</span>(original_db, db):</span>
<span id="cb78-848"><a href="#cb78-848" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> orig.model_dump() <span class="op">==</span> loaded.model_dump():</span>
<span id="cb78-849"><a href="#cb78-849" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ✅ </span><span class="sc">{</span>orig<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> data matches perfectly"</span>)</span>
<span id="cb78-850"><a href="#cb78-850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb78-851"><a href="#cb78-851" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"   ❌ </span><span class="sc">{</span>orig<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> data mismatch detected"</span>)</span>
<span id="cb78-852"><a href="#cb78-852" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb78-853"><a href="#cb78-853" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"❌ Patient count mismatch: original </span><span class="sc">{</span><span class="bu">len</span>(original_db)<span class="sc">}</span><span class="ss">, loaded </span><span class="sc">{</span><span class="bu">len</span>(db)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb78-854"><a href="#cb78-854" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb78-855"><a href="#cb78-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-856"><a href="#cb78-856" aria-hidden="true" tabindex="-1"></a><span class="co">## Summary: The Power of Pydantic</span></span>
<span id="cb78-857"><a href="#cb78-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-858"><a href="#cb78-858" aria-hidden="true" tabindex="-1"></a>Throughout this journey, we<span class="st">'ve seen how Pydantic transforms our approach to data handling:</span></span>
<span id="cb78-859"><a href="#cb78-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-860"><a href="#cb78-860" aria-hidden="true" tabindex="-1"></a><span class="er">### 🎯 **Key Benefits We've Demonstrated:**</span></span>
<span id="cb78-861"><a href="#cb78-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-862"><a href="#cb78-862" aria-hidden="true" tabindex="-1"></a><span class="fl">1.</span>  <span class="op">**</span>🛡️ Automatic Validation<span class="op">**</span>: No more manual <span class="bu">type</span> checking <span class="op">-</span> Pydantic does it automatically</span>
<span id="cb78-863"><a href="#cb78-863" aria-hidden="true" tabindex="-1"></a><span class="fl">2.</span>  <span class="op">**</span>🔄 Type Coercion<span class="op">**</span>: Smart conversion of compatible types (string <span class="st">"55"</span> → <span class="bu">float</span> <span class="fl">55.0</span>)</span>
<span id="cb78-864"><a href="#cb78-864" aria-hidden="true" tabindex="-1"></a><span class="fl">3.</span>  <span class="op">**</span>📝 Clear Error Messages<span class="op">**</span>: Helpful validation errors that pinpoint exactly what<span class="st">'s wrong</span></span>
<span id="cb78-865"><a href="#cb78-865" aria-hidden="true" tabindex="-1"></a><span class="er">4.  **🎨 Clean Code**: Models serve as documentation and enforce data contracts</span></span>
<span id="cb78-866"><a href="#cb78-866" aria-hidden="true" tabindex="-1"></a><span class="fl">5.</span>  <span class="op">**</span>🔧 Flexibility<span class="op">**</span>: Optional fields, default values, <span class="kw">and</span> custom validators</span>
<span id="cb78-867"><a href="#cb78-867" aria-hidden="true" tabindex="-1"></a><span class="fl">6.</span>  <span class="op">**</span>🌐 JSON Integration<span class="op">**</span>: Seamless serialization<span class="op">/</span>deserialization <span class="cf">with</span> validation</span>
<span id="cb78-868"><a href="#cb78-868" aria-hidden="true" tabindex="-1"></a><span class="fl">7.</span>  <span class="op">**</span>📊 Real<span class="op">-</span>world Ready<span class="op">**</span>: Handles <span class="bu">complex</span> data scenarios like CSV imports</span>
<span id="cb78-869"><a href="#cb78-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-870"><a href="#cb78-870" aria-hidden="true" tabindex="-1"></a><span class="co">### 🚀 **From Simple to Sophisticated:**</span></span>
<span id="cb78-871"><a href="#cb78-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-872"><a href="#cb78-872" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Started <span class="cf">with</span> basic <span class="bu">type</span> hints (limited enforcement)</span>
<span id="cb78-873"><a href="#cb78-873" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Added manual validation (<span class="kw">not</span> scalable)</span>
<span id="cb78-874"><a href="#cb78-874" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Introduced Pydantic models (automatic validation)</span>
<span id="cb78-875"><a href="#cb78-875" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Enhanced <span class="cf">with</span> optional fields <span class="kw">and</span> custom validators</span>
<span id="cb78-876"><a href="#cb78-876" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Integrated <span class="cf">with</span> real data processing (CSV, JSON)</span>
<span id="cb78-877"><a href="#cb78-877" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   Built a complete data management system</span>
<span id="cb78-878"><a href="#cb78-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-879"><a href="#cb78-879" aria-hidden="true" tabindex="-1"></a><span class="co">### 💡 **When to Use Pydantic:**</span></span>
<span id="cb78-880"><a href="#cb78-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-881"><a href="#cb78-881" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   <span class="op">**</span>API Development<span class="op">**</span>: Validate request<span class="op">/</span>response data</span>
<span id="cb78-882"><a href="#cb78-882" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   <span class="op">**</span>Data Processing<span class="op">**</span>: Clean <span class="kw">and</span> validate CSV<span class="op">/</span>JSON imports</span>
<span id="cb78-883"><a href="#cb78-883" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   <span class="op">**</span>Configuration Management<span class="op">**</span>: Validate application settings</span>
<span id="cb78-884"><a href="#cb78-884" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   <span class="op">**</span>Database Models<span class="op">**</span>: Ensure data integrity before persistence</span>
<span id="cb78-885"><a href="#cb78-885" aria-hidden="true" tabindex="-1"></a><span class="op">-</span>   <span class="op">**</span>Microservices<span class="op">**</span>: Validate inter<span class="op">-</span>service communication</span>
<span id="cb78-886"><a href="#cb78-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-887"><a href="#cb78-887" aria-hidden="true" tabindex="-1"></a>Pydantic transforms unreliable, error<span class="op">-</span>prone data handling into robust, <span class="va">self</span><span class="op">-</span>documenting, <span class="kw">and</span> maintainable code. It<span class="st">'s not just about validation - it'</span>s about building confidence <span class="kw">in</span> your data throughout your entire application<span class="op">!</span> 🎉</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>